function RGBColor(a){this.ok=!1,"#"==a.charAt(0)&&(a=a.substr(1,6)),a=a.replace(/ /g,""),a=a.toLowerCase();var b={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var c in b)a==c&&(a=b[c]);for(var d=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(a){return[parseInt(a[1]),parseInt(a[2]),parseInt(a[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)]}}],e=0;e<d.length;e++){var f=d[e].re,g=d[e].process,h=f.exec(a);h&&(channels=g(h),this.r=channels[0],this.g=channels[1],this.b=channels[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var a=this.r.toString(16),b=this.g.toString(16),c=this.b.toString(16);return 1==a.length&&(a="0"+a),1==b.length&&(b="0"+b),1==c.length&&(c="0"+c),"#"+a+b+c},this.getHelpXML=function(){for(var a=new Array,c=0;c<d.length;c++)for(var e=d[c].example,f=0;f<e.length;f++)a[a.length]=e[f];for(var g in b)a[a.length]=g;var h=document.createElement("ul");h.setAttribute("id","rgbcolor-examples");for(var c=0;c<a.length;c++)try{var i=document.createElement("li"),j=new RGBColor(a[c]),k=document.createElement("div");k.style.cssText="margin: 3px; border: 1px solid black; background:"+j.toHex()+"; color:"+j.toHex(),k.appendChild(document.createTextNode("test"));var l=document.createTextNode(" "+a[c]+" -> "+j.toRGB()+" -> "+j.toHex());i.appendChild(k),i.appendChild(l),h.appendChild(i)}catch(m){}return h}}function defaultFor(a,b){return"undefined"!=typeof a?a:b}function scatterPlot(a,b,c,d){this.scatterEl=a.scatterEl,this.margin=defaultFor(a.margin,{top:50,right:90,bottom:35,left:70}),this.histoEl=defaultFor(a.histoEl,!1),this.histoMargin=defaultFor(a.histoMargin,{top:30,right:70,bottom:30,left:100}),this.shorten_width=defaultFor(a.shorten_width,100),this.uom_set=defaultFor(a.uom_set,{}),this.filters_hidden=!1,this.openinfo=c,this.filterset=d,this.callback=b,this.headerNames=null,this.colors=a.colors,this.toIgnore=defaultFor(a.toIgnore,["id","active"]),this.toIgnoreHistogram=defaultFor(a.toIgnoreHistogram,["id"]),this.format_date=defaultFor(a.dateformat,"%H:%M:%S"),this.parameter_colors=null,this.col_ordinal=[],this.col_date=[],this.col_vec=[],this.grid_active=defaultFor(a.grid,!0),this.sel_x=defaultFor(a.selection_x,"Latitude"),this.sel_y=defaultFor(a.selection_y,null),this.identifiers=[],this.active_brushes=[],this.brush_extents={},this.parameter_color_range=d3.scale.category20().range(),this.hist_data={},this.parameters=null,this.y=null,this.x=null,this.x_hist=null,this.axis=null,this.height=null,this.width=null,this.selectedpoint=null,this.residuals=!1,this.lineConnections=defaultFor(a.lineConnections,!1),this.active_filters=[],this.fieldsforfiltering=defaultFor(a.fieldsforfiltering,["F","F_error","B_N","B_E","B_C","B_error","dst","kp","qdlat","mlt"]),this.single_color=defaultFor(a.single_color,!1),this.single_color_palette=null,this.left_scale=[],this.right_scale=[],this.timeformat=d3.time.format.utc.multi([[".%L",function(a){return a.getUTCMilliseconds()}],[":%S",function(a){return a.getUTCSeconds()}],["%H:%M",function(a){return a.getUTCMinutes()}],["%H:%M",function(a){return a.getUTCHours()}],["%a %d",function(a){return a.getUTCDay()&&1!=a.getDate()}],["%b %d",function(a){return 1!=a.getUTCDate()}],["%B",function(a){return a.getUTCMonth()}],["%Y",function(){return!0}]]),this.renderBlocks=defaultFor(a.renderBlocks,!1),this.renderBlocks&&(this.daily_products=!0,this.dataRange=defaultFor(a.dataRange,[0,1]),this.plotter=new plotty.plot({canvas:$("<canvas>")[0],domain:this.dataRange})),this.showDropDownSelection=defaultFor(a.showDropDownSelection,!0),d3.selectAll(".AV-point-tooltip").remove(),this.tooltip=d3.select("body").append("div").attr("class","AV-point-tooltip")}!function(){var a=function(b,c){var d=b.nodeType;if(3==d)c.push(b.textContent.replace(/&/,"&amp;").replace(/</,"&lt;").replace(">","&gt;"));else if(1==d){if(c.push("<",b.tagName),b.hasAttributes())for(var e=b.attributes,f=0,g=e.length;g>f;++f){var h=e.item(f);c.push(" ",h.name,"='",h.value,"'")}if(b.hasChildNodes()){c.push(">");for(var i=b.childNodes,f=0,g=i.length;g>f;++f)a(i.item(f),c);c.push("</",b.tagName,">")}else c.push("/>")}else{if(8!=d)throw"Error serializing XML. Unhandled node of type: "+d;c.push("<!--",b.nodeValue,"-->")}};Object.defineProperty(SVGElement.prototype,"innerHTML",{get:function(){for(var b=[],c=this.firstChild;c;)a(c,b),c=c.nextSibling;return b.join("")},set:function(a){for(;this.firstChild;)this.removeChild(this.firstChild);try{var b=new DOMParser;b.async=!1,sXML="<svg xmlns='http://www.w3.org/2000/svg'>"+a+"</svg>";for(var c=b.parseFromString(sXML,"text/xml").documentElement,d=c.firstChild;d;)this.appendChild(this.ownerDocument.importNode(d,!0)),d=d.nextSibling}catch(e){throw new Error("Error parsing XML string")}}}),Object.defineProperty(SVGElement.prototype,"innerSVG",{get:function(){return this.innerHTML},set:function(a){this.innerHTML=a}})}(),function(a,b){"use strict";"undefined"!=typeof define&&define.amd?define("canvgModule",["rgbcolor","stackblur"],b):"undefined"!=typeof module&&module.exports&&(module.exports=b(require("rgbcolor"),require("stackblur"))),a.canvg=b(a.RGBColor,a.stackBlur)}("undefined"!=typeof window?window:this,function(a,b){function c(a){var b=[0,0,0],c=function(c,d){var e=a.match(c);null!=e&&(b[d]+=e.length,a=a.replace(c," "))};return a=a.replace(/:not\(([^\)]*)\)/g,"     $1 "),a=a.replace(/{[^]*/gm," "),c(g,1),c(h,0),c(j,1),c(k,2),c(l,1),c(m,1),a=a.replace(/[\*\s\+>~]/g," "),a=a.replace(/[#\.]/g," "),c(n,2),b.join("")}function d(d){var f={opts:d};f.FRAMERATE=30,f.MAX_VIRTUAL_PIXELS=3e4,f.log=function(a){},1==f.opts.log&&"undefined"!=typeof console&&(f.log=function(a){console.log(a)}),f.init=function(a){var b=0;f.UniqueId=function(){return b++,"canvg"+b},f.Definitions={},f.Styles={},f.StylesSpecificity={},f.Animations=[],f.Images=[],f.ctx=a,f.ViewPort=new function(){this.viewPorts=[],this.Clear=function(){this.viewPorts=[]},this.SetCurrent=function(a,b){this.viewPorts.push({width:a,height:b})},this.RemoveCurrent=function(){this.viewPorts.pop()},this.Current=function(){return this.viewPorts[this.viewPorts.length-1]},this.width=function(){return this.Current().width},this.height=function(){return this.Current().height},this.ComputeSize=function(a){return null!=a&&"number"==typeof a?a:"x"==a?this.width():"y"==a?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}},f.init(),f.ImagesLoaded=function(){for(var a=0;a<f.Images.length;a++)if(!f.Images[a].loaded)return!1;return!0},f.trim=function(a){return a.replace(/^\s+|\s+$/g,"")},f.compressSpaces=function(a){return a.replace(/[\s\r\t\n]+/gm," ")},f.ajax=function(a){var b;return b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),b?(b.open("GET",a,!1),b.send(null),b.responseText):null},f.parseXml=function(a){if("undefined"!=typeof Windows&&"undefined"!=typeof Windows.Data&&"undefined"!=typeof Windows.Data.Xml){var b=new Windows.Data.Xml.Dom.XmlDocument,c=new Windows.Data.Xml.Dom.XmlLoadSettings;return c.prohibitDtd=!1,b.loadXml(a,c),b}if(window.DOMParser){var d=new DOMParser;return d.parseFromString(a,"text/xml")}a=a.replace(/<!DOCTYPE svg[^>]*>/,"");var b=new ActiveXObject("Microsoft.XMLDOM");return b.async="false",b.loadXML(a),b},f.Property=function(a,b){this.name=a,this.value=b},f.Property.prototype.getValue=function(){return this.value},f.Property.prototype.hasValue=function(){return null!=this.value&&""!==this.value},f.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var a=parseFloat(this.value);return(this.value+"").match(/%$/)&&(a/=100),a},f.Property.prototype.valueOrDefault=function(a){return this.hasValue()?this.value:a},f.Property.prototype.numValueOrDefault=function(a){return this.hasValue()?this.numValue():a},f.Property.prototype.addOpacity=function(b){var c=this.value;if(null!=b.value&&""!=b.value&&"string"==typeof this.value){var d=new a(this.value);d.ok&&(c="rgba("+d.r+", "+d.g+", "+d.b+", "+b.numValue()+")")}return new f.Property(this.name,c)},f.Property.prototype.getDefinition=function(){var a=this.value.match(/#([^\)'"]+)/);return a&&(a=a[1]),a||(a=this.value),f.Definitions[a]},f.Property.prototype.isUrlDefinition=function(){return 0==this.value.indexOf("url(")},f.Property.prototype.getFillStyleDefinition=function(a,b){var c=this.getDefinition();if(null!=c&&c.createGradient)return c.createGradient(f.ctx,a,b);if(null!=c&&c.createPattern){if(c.getHrefAttribute().hasValue()){var d=c.attribute("patternTransform");c=c.getHrefAttribute().getDefinition(),d.hasValue()&&(c.attribute("patternTransform",!0).value=d.value)}return c.createPattern(f.ctx,a)}return null},f.Property.prototype.getDPI=function(a){return 96},f.Property.prototype.getEM=function(a){var b=12,c=new f.Property("fontSize",f.Font.Parse(f.ctx.font).fontSize);return c.hasValue()&&(b=c.toPixels(a)),b},f.Property.prototype.getUnits=function(){var a=this.value+"";return a.replace(/[0-9\.\-]/g,"")},f.Property.prototype.toPixels=function(a,b){if(!this.hasValue())return 0;var c=this.value+"";if(c.match(/em$/))return this.numValue()*this.getEM(a);if(c.match(/ex$/))return this.numValue()*this.getEM(a)/2;if(c.match(/px$/))return this.numValue();if(c.match(/pt$/))return this.numValue()*this.getDPI(a)*(1/72);if(c.match(/pc$/))return 15*this.numValue();if(c.match(/cm$/))return this.numValue()*this.getDPI(a)/2.54;if(c.match(/mm$/))return this.numValue()*this.getDPI(a)/25.4;if(c.match(/in$/))return this.numValue()*this.getDPI(a);if(c.match(/%$/))return this.numValue()*f.ViewPort.ComputeSize(a);var d=this.numValue();return b&&1>d?d*f.ViewPort.ComputeSize(a):d},f.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var a=this.value+"";return a.match(/s$/)?1e3*this.numValue():a.match(/ms$/)?this.numValue():this.numValue()},f.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var a=this.value+"";return a.match(/deg$/)?this.numValue()*(Math.PI/180):a.match(/grad$/)?this.numValue()*(Math.PI/200):a.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180)};var g={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};return f.Property.prototype.toTextBaseline=function(){return this.hasValue()?g[this.value]:null},f.Font=new function(){this.Styles="normal|italic|oblique|inherit",this.Variants="normal|small-caps|inherit",this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit",this.CreateFont=function(a,b,c,d,e,g){var h=null!=g?this.Parse(g):this.CreateFont("","","","","",f.ctx.font);return{fontFamily:e||h.fontFamily,fontSize:d||h.fontSize,fontStyle:a||h.fontStyle,fontWeight:c||h.fontWeight,fontVariant:b||h.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var a=this;this.Parse=function(b){for(var c={},d=f.trim(f.compressSpaces(b||"")).split(" "),e={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1},g="",h=0;h<d.length;h++)e.fontStyle||-1==a.Styles.indexOf(d[h])?e.fontVariant||-1==a.Variants.indexOf(d[h])?e.fontWeight||-1==a.Weights.indexOf(d[h])?e.fontSize?"inherit"!=d[h]&&(g+=d[h]):("inherit"!=d[h]&&(c.fontSize=d[h].split("/")[0]),e.fontStyle=e.fontVariant=e.fontWeight=e.fontSize=!0):("inherit"!=d[h]&&(c.fontWeight=d[h]),e.fontStyle=e.fontVariant=e.fontWeight=!0):("inherit"!=d[h]&&(c.fontVariant=d[h]),e.fontStyle=e.fontVariant=!0):("inherit"!=d[h]&&(c.fontStyle=d[h]),e.fontStyle=!0);return""!=g&&(c.fontFamily=g),c}},f.ToNumberArray=function(a){for(var b=f.trim(f.compressSpaces((a||"").replace(/,/g," "))).split(" "),c=0;c<b.length;c++)b[c]=parseFloat(b[c]);return b},f.Point=function(a,b){this.x=a,this.y=b},f.Point.prototype.angleTo=function(a){return Math.atan2(a.y-this.y,a.x-this.x)},f.Point.prototype.applyTransform=function(a){var b=this.x*a[0]+this.y*a[2]+a[4],c=this.x*a[1]+this.y*a[3]+a[5];this.x=b,this.y=c},f.CreatePoint=function(a){var b=f.ToNumberArray(a);return new f.Point(b[0],b[1])},f.CreatePath=function(a){for(var b=f.ToNumberArray(a),c=[],d=0;d<b.length;d+=2)c.push(new f.Point(b[d],b[d+1]));return c},f.BoundingBox=function(a,b,c,d){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=function(){return this.x1},this.y=function(){return this.y1},this.width=function(){return this.x2-this.x1},this.height=function(){return this.y2-this.y1},this.addPoint=function(a,b){null!=a&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=a,this.x2=a),a<this.x1&&(this.x1=a),a>this.x2&&(this.x2=a)),null!=b&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=b,this.y2=b),b<this.y1&&(this.y1=b),b>this.y2&&(this.y2=b))},this.addX=function(a){this.addPoint(a,null)},this.addY=function(a){this.addPoint(null,a)},this.addBoundingBox=function(a){this.addPoint(a.x1,a.y1),this.addPoint(a.x2,a.y2)},this.addQuadraticCurve=function(a,b,c,d,e,f){var g=a+2/3*(c-a),h=b+2/3*(d-b),i=g+1/3*(e-a),j=h+1/3*(f-b);this.addBezierCurve(a,b,g,i,h,j,e,f)},this.addBezierCurve=function(a,b,c,d,e,f,g,h){var j=[a,b],k=[c,d],l=[e,f],m=[g,h];for(this.addPoint(j[0],j[1]),this.addPoint(m[0],m[1]),i=0;i<=1;i++){var n=function(a){return Math.pow(1-a,3)*j[i]+3*Math.pow(1-a,2)*a*k[i]+3*(1-a)*Math.pow(a,2)*l[i]+Math.pow(a,3)*m[i]},o=6*j[i]-12*k[i]+6*l[i],p=-3*j[i]+9*k[i]-9*l[i]+3*m[i],q=3*k[i]-3*j[i];if(0!=p){var r=Math.pow(o,2)-4*q*p;if(!(0>r)){var s=(-o+Math.sqrt(r))/(2*p);s>0&&1>s&&(0==i&&this.addX(n(s)),1==i&&this.addY(n(s)));var t=(-o-Math.sqrt(r))/(2*p);t>0&&1>t&&(0==i&&this.addX(n(t)),1==i&&this.addY(n(t)))}}else{if(0==o)continue;var u=-q/o;u>0&&1>u&&(0==i&&this.addX(n(u)),1==i&&this.addY(n(u)))}}},this.isPointInBox=function(a,b){return this.x1<=a&&a<=this.x2&&this.y1<=b&&b<=this.y2},this.addPoint(a,b),this.addPoint(c,d)},f.Transform=function(a){var b=this;this.Type={},this.Type.translate=function(a){this.p=f.CreatePoint(a),this.apply=function(a){a.translate(this.p.x||0,this.p.y||0)},this.unapply=function(a){a.translate(-1*this.p.x||0,-1*this.p.y||0)},this.applyToPoint=function(a){a.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}},this.Type.rotate=function(a){var b=f.ToNumberArray(a);this.angle=new f.Property("angle",b[0]),this.cx=b[1]||0,this.cy=b[2]||0,this.apply=function(a){a.translate(this.cx,this.cy),a.rotate(this.angle.toRadians()),a.translate(-this.cx,-this.cy)},this.unapply=function(a){a.translate(this.cx,this.cy),a.rotate(-1*this.angle.toRadians()),a.translate(-this.cx,-this.cy)},this.applyToPoint=function(a){var b=this.angle.toRadians();a.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]),a.applyTransform([Math.cos(b),Math.sin(b),-Math.sin(b),Math.cos(b),0,0]),a.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}},this.Type.scale=function(a){this.p=f.CreatePoint(a),this.apply=function(a){a.scale(this.p.x||1,this.p.y||this.p.x||1)},this.unapply=function(a){a.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)},this.applyToPoint=function(a){a.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}},this.Type.matrix=function(a){this.m=f.ToNumberArray(a),this.apply=function(a){a.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},this.unapply=function(a){var b=this.m[0],c=this.m[2],d=this.m[4],e=this.m[1],f=this.m[3],g=this.m[5],h=0,i=0,j=1,k=1/(b*(f*j-g*i)-c*(e*j-g*h)+d*(e*i-f*h));a.transform(k*(f*j-g*i),k*(g*h-e*j),k*(d*i-c*j),k*(b*j-d*h),k*(c*g-d*f),k*(d*e-b*g))},this.applyToPoint=function(a){a.applyTransform(this.m)}},this.Type.SkewBase=function(a){this.base=b.Type.matrix,this.base(a),this.angle=new f.Property("angle",a)},this.Type.SkewBase.prototype=new this.Type.matrix,this.Type.skewX=function(a){this.base=b.Type.SkewBase,this.base(a),this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]},this.Type.skewX.prototype=new this.Type.SkewBase,this.Type.skewY=function(a){this.base=b.Type.SkewBase,this.base(a),this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]},this.Type.skewY.prototype=new this.Type.SkewBase,this.transforms=[],this.apply=function(a){for(var b=0;b<this.transforms.length;b++)this.transforms[b].apply(a)},this.unapply=function(a){for(var b=this.transforms.length-1;b>=0;b--)this.transforms[b].unapply(a)},this.applyToPoint=function(a){for(var b=0;b<this.transforms.length;b++)this.transforms[b].applyToPoint(a)};for(var c=f.trim(f.compressSpaces(a)).replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/),d=0;d<c.length;d++){var e=f.trim(c[d].split("(")[0]),g=c[d].split("(")[1].replace(")",""),h=new this.Type[e](g);h.type=e,this.transforms.push(h)}},f.AspectRatio=function(a,b,c,d,e,g,h,i,j,k){b=f.compressSpaces(b),b=b.replace(/^defer\s/,"");var l=b.split(" ")[0]||"xMidYMid",m=b.split(" ")[1]||"meet",n=c/d,o=e/g,p=Math.min(n,o),q=Math.max(n,o);"meet"==m&&(d*=p,g*=p),"slice"==m&&(d*=q,g*=q),j=new f.Property("refX",j),k=new f.Property("refY",k),j.hasValue()&&k.hasValue()?a.translate(-p*j.toPixels("x"),-p*k.toPixels("y")):(l.match(/^xMid/)&&("meet"==m&&p==o||"slice"==m&&q==o)&&a.translate(c/2-d/2,0),l.match(/YMid$/)&&("meet"==m&&p==n||"slice"==m&&q==n)&&a.translate(0,e/2-g/2),l.match(/^xMax/)&&("meet"==m&&p==o||"slice"==m&&q==o)&&a.translate(c-d,0),l.match(/YMax$/)&&("meet"==m&&p==n||"slice"==m&&q==n)&&a.translate(0,e-g)),"none"==l?a.scale(n,o):"meet"==m?a.scale(p,p):"slice"==m&&a.scale(q,q),a.translate(null==h?0:-h,null==i?0:-i)},f.Element={},f.EmptyProperty=new f.Property("EMPTY",""),f.Element.ElementBase=function(a){if(this.attributes={},this.styles={},this.stylesSpecificity={},this.children=[],this.attribute=function(a,b){var c=this.attributes[a];return null!=c?c:(1==b&&(c=new f.Property(a,""),this.attributes[a]=c),c||f.EmptyProperty)},this.getHrefAttribute=function(){for(var a in this.attributes)if("href"==a||a.match(/:href$/))return this.attributes[a];return f.EmptyProperty},this.style=function(a,b,c){var d=this.styles[a];if(null!=d)return d;var e=this.attribute(a);if(null!=e&&e.hasValue())return this.styles[a]=e,e;if(1!=c){var g=this.parent;if(null!=g){var h=g.style(a);if(null!=h&&h.hasValue())return h}}return 1==b&&(d=new f.Property(a,""),this.styles[a]=d),d||f.EmptyProperty},this.render=function(a){if("none"!=this.style("display").value&&"hidden"!=this.style("visibility").value){if(a.save(),this.style("mask").hasValue()){var b=this.style("mask").getDefinition();null!=b&&b.apply(a,this)}else if(this.style("filter").hasValue()){var c=this.style("filter").getDefinition();null!=c&&c.apply(a,this)}else this.setContext(a),this.renderChildren(a),this.clearContext(a);a.restore()}},this.setContext=function(a){},this.clearContext=function(a){},this.renderChildren=function(a){for(var b=0;b<this.children.length;b++)this.children[b].render(a)},this.addChild=function(a,b){var c=a;b&&(c=f.CreateElement(a)),c.parent=this,"title"!=c.type&&this.children.push(c)},this.addStylesFromStyleDefinition=function(){for(var b in f.Styles)if("@"!=b[0]&&e(a,b)){var c=f.Styles[b],d=f.StylesSpecificity[b];if(null!=c)for(var g in c){var h=this.stylesSpecificity[g];"undefined"==typeof h&&(h="000"),d>h&&(this.styles[g]=c[g],this.stylesSpecificity[g]=d)}}},null!=a&&1==a.nodeType){for(var b=0;b<a.attributes.length;b++){var c=a.attributes[b];this.attributes[c.nodeName]=new f.Property(c.nodeName,c.value)}if(this.addStylesFromStyleDefinition(),this.attribute("style").hasValue())for(var d=this.attribute("style").value.split(";"),b=0;b<d.length;b++)if(""!=f.trim(d[b])){var g=d[b].split(":"),h=f.trim(g[0]),i=f.trim(g[1]);this.styles[h]=new f.Property(h,i)}this.attribute("id").hasValue()&&null==f.Definitions[this.attribute("id").value]&&(f.Definitions[this.attribute("id").value]=this);for(var b=0;b<a.childNodes.length;b++){var j=a.childNodes[b];if(1==j.nodeType&&this.addChild(j,!0),this.captureTextNodes&&(3==j.nodeType||4==j.nodeType)){var k=j.value||j.text||j.textContent||"";""!=f.compressSpaces(k)&&this.addChild(new f.Element.tspan(j),!1)}}}},f.Element.RenderedElementBase=function(a){this.base=f.Element.ElementBase,this.base(a),this.setContext=function(a){if(this.style("fill").isUrlDefinition()){var b=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity"));null!=b&&(a.fillStyle=b)}else if(this.style("fill").hasValue()){var c=this.style("fill");"currentColor"==c.value&&(c.value=this.style("color").value),"inherit"!=c.value&&(a.fillStyle="none"==c.value?"rgba(0,0,0,0)":c.value)}if(this.style("fill-opacity").hasValue()){var c=new f.Property("fill",a.fillStyle);c=c.addOpacity(this.style("fill-opacity")),a.fillStyle=c.value}if(this.style("stroke").isUrlDefinition()){var b=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity"));null!=b&&(a.strokeStyle=b)}else if(this.style("stroke").hasValue()){var d=this.style("stroke");"currentColor"==d.value&&(d.value=this.style("color").value),"inherit"!=d.value&&(a.strokeStyle="none"==d.value?"rgba(0,0,0,0)":d.value)}if(this.style("stroke-opacity").hasValue()){var d=new f.Property("stroke",a.strokeStyle);d=d.addOpacity(this.style("stroke-opacity")),a.strokeStyle=d.value}if(this.style("stroke-width").hasValue()){var e=this.style("stroke-width").toPixels();a.lineWidth=0==e?.001:e}if(this.style("stroke-linecap").hasValue()&&(a.lineCap=this.style("stroke-linecap").value),this.style("stroke-linejoin").hasValue()&&(a.lineJoin=this.style("stroke-linejoin").value),this.style("stroke-miterlimit").hasValue()&&(a.miterLimit=this.style("stroke-miterlimit").value),this.style("stroke-dasharray").hasValue()&&"none"!=this.style("stroke-dasharray").value){var g=f.ToNumberArray(this.style("stroke-dasharray").value);"undefined"!=typeof a.setLineDash?a.setLineDash(g):"undefined"!=typeof a.webkitLineDash?a.webkitLineDash=g:"undefined"==typeof a.mozDash||1==g.length&&0==g[0]||(a.mozDash=g);var h=this.style("stroke-dashoffset").numValueOrDefault(1);"undefined"!=typeof a.lineDashOffset?a.lineDashOffset=h:"undefined"!=typeof a.webkitLineDashOffset?a.webkitLineDashOffset=h:"undefined"!=typeof a.mozDashOffset&&(a.mozDashOffset=h)}if("undefined"!=typeof a.font&&(a.font=f.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString()),this.style("transform",!1,!0).hasValue()){var i=new f.Transform(this.style("transform",!1,!0).value);i.apply(a)}if(this.style("clip-path",!1,!0).hasValue()){var j=this.style("clip-path",!1,!0).getDefinition();null!=j&&j.apply(a)}this.style("opacity").hasValue()&&(a.globalAlpha=this.style("opacity").numValue())}},f.Element.RenderedElementBase.prototype=new f.Element.ElementBase,f.Element.PathElementBase=function(a){this.base=f.Element.RenderedElementBase,this.base(a),this.path=function(a){return null!=a&&a.beginPath(),new f.BoundingBox},this.renderChildren=function(a){this.path(a),f.Mouse.checkPath(this,a),""!=a.fillStyle&&("inherit"!=this.style("fill-rule").valueOrDefault("inherit")?a.fill(this.style("fill-rule").value):a.fill()),""!=a.strokeStyle&&a.stroke();var b=this.getMarkers();if(null!=b){if(this.style("marker-start").isUrlDefinition()){var c=this.style("marker-start").getDefinition();c.render(a,b[0][0],b[0][1])}if(this.style("marker-mid").isUrlDefinition())for(var c=this.style("marker-mid").getDefinition(),d=1;d<b.length-1;d++)c.render(a,b[d][0],b[d][1]);if(this.style("marker-end").isUrlDefinition()){var c=this.style("marker-end").getDefinition();c.render(a,b[b.length-1][0],b[b.length-1][1])}}},this.getBoundingBox=function(){return this.path()},this.getMarkers=function(){return null}},f.Element.PathElementBase.prototype=new f.Element.RenderedElementBase,f.Element.svg=function(a){this.base=f.Element.RenderedElementBase,this.base(a),this.baseClearContext=this.clearContext,this.clearContext=function(a){this.baseClearContext(a),f.ViewPort.RemoveCurrent()},this.baseSetContext=this.setContext,this.setContext=function(a){a.strokeStyle="rgba(0,0,0,0)",a.lineCap="butt",a.lineJoin="miter",a.miterLimit=4,"undefined"!=typeof a.font&&"undefined"!=typeof window.getComputedStyle&&(a.font=window.getComputedStyle(a.canvas).getPropertyValue("font")),this.baseSetContext(a),this.attribute("x").hasValue()||(this.attribute("x",!0).value=0),this.attribute("y").hasValue()||(this.attribute("y",!0).value=0),a.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var b=f.ViewPort.width(),c=f.ViewPort.height();if(this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%"),this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%"),"undefined"==typeof this.root){b=this.attribute("width").toPixels("x"),c=this.attribute("height").toPixels("y");var d=0,e=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(d=-this.attribute("refX").toPixels("x"),e=-this.attribute("refY").toPixels("y")),"visible"!=this.attribute("overflow").valueOrDefault("hidden")&&(a.beginPath(),a.moveTo(d,e),a.lineTo(b,e),a.lineTo(b,c),a.lineTo(d,c),a.closePath(),a.clip())}if(f.ViewPort.SetCurrent(b,c),this.attribute("viewBox").hasValue()){var g=f.ToNumberArray(this.attribute("viewBox").value),h=g[0],i=g[1];b=g[2],c=g[3],f.AspectRatio(a,this.attribute("preserveAspectRatio").value,f.ViewPort.width(),b,f.ViewPort.height(),c,h,i,this.attribute("refX").value,this.attribute("refY").value),f.ViewPort.RemoveCurrent(),f.ViewPort.SetCurrent(g[2],g[3])}}},f.Element.svg.prototype=new f.Element.RenderedElementBase,f.Element.rect=function(a){this.base=f.Element.PathElementBase,this.base(a),this.path=function(a){var b=this.attribute("x").toPixels("x"),c=this.attribute("y").toPixels("y"),d=this.attribute("width").toPixels("x"),e=this.attribute("height").toPixels("y"),g=this.attribute("rx").toPixels("x"),h=this.attribute("ry").toPixels("y");return this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(h=g),this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()&&(g=h),g=Math.min(g,d/2),h=Math.min(h,e/2),null!=a&&(a.beginPath(),a.moveTo(b+g,c),a.lineTo(b+d-g,c),a.quadraticCurveTo(b+d,c,b+d,c+h),a.lineTo(b+d,c+e-h),a.quadraticCurveTo(b+d,c+e,b+d-g,c+e),a.lineTo(b+g,c+e),a.quadraticCurveTo(b,c+e,b,c+e-h),a.lineTo(b,c+h),a.quadraticCurveTo(b,c,b+g,c),a.closePath()),new f.BoundingBox(b,c,b+d,c+e)}},f.Element.rect.prototype=new f.Element.PathElementBase,f.Element.circle=function(a){this.base=f.Element.PathElementBase,this.base(a),this.path=function(a){var b=this.attribute("cx").toPixels("x"),c=this.attribute("cy").toPixels("y"),d=this.attribute("r").toPixels();return null!=a&&(a.beginPath(),a.arc(b,c,d,0,2*Math.PI,!0),a.closePath()),new f.BoundingBox(b-d,c-d,b+d,c+d)}},f.Element.circle.prototype=new f.Element.PathElementBase,f.Element.ellipse=function(a){this.base=f.Element.PathElementBase,this.base(a),this.path=function(a){var b=4*((Math.sqrt(2)-1)/3),c=this.attribute("rx").toPixels("x"),d=this.attribute("ry").toPixels("y"),e=this.attribute("cx").toPixels("x"),g=this.attribute("cy").toPixels("y");return null!=a&&(a.beginPath(),a.moveTo(e,g-d),a.bezierCurveTo(e+b*c,g-d,e+c,g-b*d,e+c,g),a.bezierCurveTo(e+c,g+b*d,e+b*c,g+d,e,g+d),a.bezierCurveTo(e-b*c,g+d,e-c,g+b*d,e-c,g),a.bezierCurveTo(e-c,g-b*d,e-b*c,g-d,e,g-d),a.closePath()),new f.BoundingBox(e-c,g-d,e+c,g+d)}},f.Element.ellipse.prototype=new f.Element.PathElementBase,f.Element.line=function(a){this.base=f.Element.PathElementBase,this.base(a),this.getPoints=function(){return[new f.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new f.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]},this.path=function(a){var b=this.getPoints();return null!=a&&(a.beginPath(),a.moveTo(b[0].x,b[0].y),a.lineTo(b[1].x,b[1].y)),new f.BoundingBox(b[0].x,b[0].y,b[1].x,b[1].y)},this.getMarkers=function(){var a=this.getPoints(),b=a[0].angleTo(a[1]);return[[a[0],b],[a[1],b]]}},f.Element.line.prototype=new f.Element.PathElementBase,f.Element.polyline=function(a){this.base=f.Element.PathElementBase,this.base(a),this.points=f.CreatePath(this.attribute("points").value),this.path=function(a){var b=new f.BoundingBox(this.points[0].x,this.points[0].y);null!=a&&(a.beginPath(),a.moveTo(this.points[0].x,this.points[0].y));for(var c=1;c<this.points.length;c++)b.addPoint(this.points[c].x,this.points[c].y),null!=a&&a.lineTo(this.points[c].x,this.points[c].y);return b},this.getMarkers=function(){for(var a=[],b=0;b<this.points.length-1;b++)a.push([this.points[b],this.points[b].angleTo(this.points[b+1])]);return a.push([this.points[this.points.length-1],a[a.length-1][1]]),a}},f.Element.polyline.prototype=new f.Element.PathElementBase,f.Element.polygon=function(a){this.base=f.Element.polyline,this.base(a),this.basePath=this.path,this.path=function(a){var b=this.basePath(a);return null!=a&&(a.lineTo(this.points[0].x,this.points[0].y),a.closePath()),b}},f.Element.polygon.prototype=new f.Element.polyline,
f.Element.path=function(a){this.base=f.Element.PathElementBase,this.base(a);var b=this.attribute("d").value;b=b.replace(/,/gm," ");for(var c=0;2>c;c++)b=b.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2");b=b.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),b=b.replace(/([0-9])([+\-])/gm,"$1 $2");for(var c=0;2>c;c++)b=b.replace(/(\.[0-9]*)(\.)/gm,"$1 $2");b=b.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),b=f.compressSpaces(b),b=f.trim(b),this.PathParser=new function(a){this.tokens=a.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new f.Point(0,0),this.control=new f.Point(0,0),this.current=new f.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return this.isEnd()?!0:null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)},this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return!0}return!1},this.getToken=function(){return this.i++,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(){var a=new f.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(a)},this.getAsControlPoint=function(){var a=this.getPoint();return this.control=a,a},this.getAsCurrentPoint=function(){var a=this.getPoint();return this.current=a,a},this.getReflectedControlPoint=function(){if("c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()&&"q"!=this.previousCommand.toLowerCase()&&"t"!=this.previousCommand.toLowerCase())return this.current;var a=new f.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y);return a},this.makeAbsolute=function(a){return this.isRelativeCommand()&&(a.x+=this.current.x,a.y+=this.current.y),a},this.addMarker=function(a,b,c){null!=c&&this.angles.length>0&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(c)),this.addMarkerAngle(a,null==b?null:b.angleTo(a))},this.addMarkerAngle=function(a,b){this.points.push(a),this.angles.push(b)},this.getMarkerPoints=function(){return this.points},this.getMarkerAngles=function(){for(var a=0;a<this.angles.length;a++)if(null==this.angles[a])for(var b=a+1;b<this.angles.length;b++)if(null!=this.angles[b]){this.angles[a]=this.angles[b];break}return this.angles}}(b),this.path=function(a){var b=this.PathParser;b.reset();var c=new f.BoundingBox;for(null!=a&&a.beginPath();!b.isEnd();)switch(b.nextCommand(),b.command){case"M":case"m":var d=b.getAsCurrentPoint();for(b.addMarker(d),c.addPoint(d.x,d.y),null!=a&&a.moveTo(d.x,d.y),b.start=b.current;!b.isCommandOrEnd();){var d=b.getAsCurrentPoint();b.addMarker(d,b.start),c.addPoint(d.x,d.y),null!=a&&a.lineTo(d.x,d.y)}break;case"L":case"l":for(;!b.isCommandOrEnd();){var e=b.current,d=b.getAsCurrentPoint();b.addMarker(d,e),c.addPoint(d.x,d.y),null!=a&&a.lineTo(d.x,d.y)}break;case"H":case"h":for(;!b.isCommandOrEnd();){var g=new f.Point((b.isRelativeCommand()?b.current.x:0)+b.getScalar(),b.current.y);b.addMarker(g,b.current),b.current=g,c.addPoint(b.current.x,b.current.y),null!=a&&a.lineTo(b.current.x,b.current.y)}break;case"V":case"v":for(;!b.isCommandOrEnd();){var g=new f.Point(b.current.x,(b.isRelativeCommand()?b.current.y:0)+b.getScalar());b.addMarker(g,b.current),b.current=g,c.addPoint(b.current.x,b.current.y),null!=a&&a.lineTo(b.current.x,b.current.y)}break;case"C":case"c":for(;!b.isCommandOrEnd();){var h=b.current,i=b.getPoint(),j=b.getAsControlPoint(),k=b.getAsCurrentPoint();b.addMarker(k,j,i),c.addBezierCurve(h.x,h.y,i.x,i.y,j.x,j.y,k.x,k.y),null!=a&&a.bezierCurveTo(i.x,i.y,j.x,j.y,k.x,k.y)}break;case"S":case"s":for(;!b.isCommandOrEnd();){var h=b.current,i=b.getReflectedControlPoint(),j=b.getAsControlPoint(),k=b.getAsCurrentPoint();b.addMarker(k,j,i),c.addBezierCurve(h.x,h.y,i.x,i.y,j.x,j.y,k.x,k.y),null!=a&&a.bezierCurveTo(i.x,i.y,j.x,j.y,k.x,k.y)}break;case"Q":case"q":for(;!b.isCommandOrEnd();){var h=b.current,j=b.getAsControlPoint(),k=b.getAsCurrentPoint();b.addMarker(k,j,j),c.addQuadraticCurve(h.x,h.y,j.x,j.y,k.x,k.y),null!=a&&a.quadraticCurveTo(j.x,j.y,k.x,k.y)}break;case"T":case"t":for(;!b.isCommandOrEnd();){var h=b.current,j=b.getReflectedControlPoint();b.control=j;var k=b.getAsCurrentPoint();b.addMarker(k,j,j),c.addQuadraticCurve(h.x,h.y,j.x,j.y,k.x,k.y),null!=a&&a.quadraticCurveTo(j.x,j.y,k.x,k.y)}break;case"A":case"a":for(;!b.isCommandOrEnd();){var h=b.current,l=b.getScalar(),m=b.getScalar(),n=b.getScalar()*(Math.PI/180),o=b.getScalar(),p=b.getScalar(),k=b.getAsCurrentPoint(),q=new f.Point(Math.cos(n)*(h.x-k.x)/2+Math.sin(n)*(h.y-k.y)/2,-Math.sin(n)*(h.x-k.x)/2+Math.cos(n)*(h.y-k.y)/2),r=Math.pow(q.x,2)/Math.pow(l,2)+Math.pow(q.y,2)/Math.pow(m,2);r>1&&(l*=Math.sqrt(r),m*=Math.sqrt(r));var s=(o==p?-1:1)*Math.sqrt((Math.pow(l,2)*Math.pow(m,2)-Math.pow(l,2)*Math.pow(q.y,2)-Math.pow(m,2)*Math.pow(q.x,2))/(Math.pow(l,2)*Math.pow(q.y,2)+Math.pow(m,2)*Math.pow(q.x,2)));isNaN(s)&&(s=0);var t=new f.Point(s*l*q.y/m,s*-m*q.x/l),u=new f.Point((h.x+k.x)/2+Math.cos(n)*t.x-Math.sin(n)*t.y,(h.y+k.y)/2+Math.sin(n)*t.x+Math.cos(n)*t.y),v=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2))},w=function(a,b){return(a[0]*b[0]+a[1]*b[1])/(v(a)*v(b))},x=function(a,b){return(a[0]*b[1]<a[1]*b[0]?-1:1)*Math.acos(w(a,b))},y=x([1,0],[(q.x-t.x)/l,(q.y-t.y)/m]),z=[(q.x-t.x)/l,(q.y-t.y)/m],A=[(-q.x-t.x)/l,(-q.y-t.y)/m],B=x(z,A);w(z,A)<=-1&&(B=Math.PI),w(z,A)>=1&&(B=0);var C=1-p?1:-1,D=y+C*(B/2),E=new f.Point(u.x+l*Math.cos(D),u.y+m*Math.sin(D));if(b.addMarkerAngle(E,D-C*Math.PI/2),b.addMarkerAngle(k,D-C*Math.PI),c.addPoint(k.x,k.y),null!=a){var w=l>m?l:m,F=l>m?1:l/m,G=l>m?m/l:1;a.translate(u.x,u.y),a.rotate(n),a.scale(F,G),a.arc(0,0,w,y,y+B,1-p),a.scale(1/F,1/G),a.rotate(-n),a.translate(-u.x,-u.y)}}break;case"Z":case"z":null!=a&&a.closePath(),b.current=b.start}return c},this.getMarkers=function(){for(var a=this.PathParser.getMarkerPoints(),b=this.PathParser.getMarkerAngles(),c=[],d=0;d<a.length;d++)c.push([a[d],b[d]]);return c}},f.Element.path.prototype=new f.Element.PathElementBase,f.Element.pattern=function(a){this.base=f.Element.ElementBase,this.base(a),this.createPattern=function(a,b){var c=this.attribute("width").toPixels("x",!0),d=this.attribute("height").toPixels("y",!0),e=new f.Element.svg;e.attributes.viewBox=new f.Property("viewBox",this.attribute("viewBox").value),e.attributes.width=new f.Property("width",c+"px"),e.attributes.height=new f.Property("height",d+"px"),e.attributes.transform=new f.Property("transform",this.attribute("patternTransform").value),e.children=this.children;var g=document.createElement("canvas");g.width=c,g.height=d;var h=g.getContext("2d");this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&h.translate(this.attribute("x").toPixels("x",!0),this.attribute("y").toPixels("y",!0));for(var i=-1;1>=i;i++)for(var j=-1;1>=j;j++)h.save(),e.attributes.x=new f.Property("x",i*g.width),e.attributes.y=new f.Property("y",j*g.height),e.render(h),h.restore();var k=a.createPattern(g,"repeat");return k}},f.Element.pattern.prototype=new f.Element.ElementBase,f.Element.marker=function(a){this.base=f.Element.ElementBase,this.base(a),this.baseRender=this.render,this.render=function(a,b,c){a.translate(b.x,b.y),"auto"==this.attribute("orient").valueOrDefault("auto")&&a.rotate(c),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&a.scale(a.lineWidth,a.lineWidth),a.save();var d=new f.Element.svg;d.attributes.viewBox=new f.Property("viewBox",this.attribute("viewBox").value),d.attributes.refX=new f.Property("refX",this.attribute("refX").value),d.attributes.refY=new f.Property("refY",this.attribute("refY").value),d.attributes.width=new f.Property("width",this.attribute("markerWidth").value),d.attributes.height=new f.Property("height",this.attribute("markerHeight").value),d.attributes.fill=new f.Property("fill",this.attribute("fill").valueOrDefault("black")),d.attributes.stroke=new f.Property("stroke",this.attribute("stroke").valueOrDefault("none")),d.children=this.children,d.render(a),a.restore(),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&a.scale(1/a.lineWidth,1/a.lineWidth),"auto"==this.attribute("orient").valueOrDefault("auto")&&a.rotate(-c),a.translate(-b.x,-b.y)}},f.Element.marker.prototype=new f.Element.ElementBase,f.Element.defs=function(a){this.base=f.Element.ElementBase,this.base(a),this.render=function(a){}},f.Element.defs.prototype=new f.Element.ElementBase,f.Element.GradientBase=function(a){this.base=f.Element.ElementBase,this.base(a),this.stops=[];for(var b=0;b<this.children.length;b++){var c=this.children[b];"stop"==c.type&&this.stops.push(c)}this.getGradient=function(){},this.gradientUnits=function(){return this.attribute("gradientUnits").valueOrDefault("objectBoundingBox")},this.attributesToInherit=["gradientUnits"],this.inheritStopContainer=function(a){for(var b=0;b<this.attributesToInherit.length;b++){var c=this.attributesToInherit[b];!this.attribute(c).hasValue()&&a.attribute(c).hasValue()&&(this.attribute(c,!0).value=a.attribute(c).value)}},this.createGradient=function(a,b,c){var d=this;this.getHrefAttribute().hasValue()&&(d=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(d));var e=function(a){if(c.hasValue()){var b=new f.Property("color",a);return b.addOpacity(c).value}return a},g=this.getGradient(a,b);if(null==g)return e(d.stops[d.stops.length-1].color);for(var h=0;h<d.stops.length;h++)g.addColorStop(d.stops[h].offset,e(d.stops[h].color));if(this.attribute("gradientTransform").hasValue()){var i=f.ViewPort.viewPorts[0],j=new f.Element.rect;j.attributes.x=new f.Property("x",-f.MAX_VIRTUAL_PIXELS/3),j.attributes.y=new f.Property("y",-f.MAX_VIRTUAL_PIXELS/3),j.attributes.width=new f.Property("width",f.MAX_VIRTUAL_PIXELS),j.attributes.height=new f.Property("height",f.MAX_VIRTUAL_PIXELS);var k=new f.Element.g;k.attributes.transform=new f.Property("transform",this.attribute("gradientTransform").value),k.children=[j];var l=new f.Element.svg;l.attributes.x=new f.Property("x",0),l.attributes.y=new f.Property("y",0),l.attributes.width=new f.Property("width",i.width),l.attributes.height=new f.Property("height",i.height),l.children=[k];var m=document.createElement("canvas");m.width=i.width,m.height=i.height;var n=m.getContext("2d");return n.fillStyle=g,l.render(n),n.createPattern(m,"no-repeat")}return g}},f.Element.GradientBase.prototype=new f.Element.ElementBase,f.Element.linearGradient=function(a){this.base=f.Element.GradientBase,this.base(a),this.attributesToInherit.push("x1"),this.attributesToInherit.push("y1"),this.attributesToInherit.push("x2"),this.attributesToInherit.push("y2"),this.getGradient=function(a,b){var c="objectBoundingBox"==this.gradientUnits()?b.getBoundingBox():null;this.attribute("x1").hasValue()||this.attribute("y1").hasValue()||this.attribute("x2").hasValue()||this.attribute("y2").hasValue()||(this.attribute("x1",!0).value=0,this.attribute("y1",!0).value=0,this.attribute("x2",!0).value=1,this.attribute("y2",!0).value=0);var d="objectBoundingBox"==this.gradientUnits()?c.x()+c.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"),e="objectBoundingBox"==this.gradientUnits()?c.y()+c.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),f="objectBoundingBox"==this.gradientUnits()?c.x()+c.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),g="objectBoundingBox"==this.gradientUnits()?c.y()+c.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return d==f&&e==g?null:a.createLinearGradient(d,e,f,g)}},f.Element.linearGradient.prototype=new f.Element.GradientBase,f.Element.radialGradient=function(a){this.base=f.Element.GradientBase,this.base(a),this.attributesToInherit.push("cx"),this.attributesToInherit.push("cy"),this.attributesToInherit.push("r"),this.attributesToInherit.push("fx"),this.attributesToInherit.push("fy"),this.getGradient=function(a,b){var c=b.getBoundingBox();this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%"),this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%"),this.attribute("r").hasValue()||(this.attribute("r",!0).value="50%");var d="objectBoundingBox"==this.gradientUnits()?c.x()+c.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"),e="objectBoundingBox"==this.gradientUnits()?c.y()+c.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),f=d,g=e;this.attribute("fx").hasValue()&&(f="objectBoundingBox"==this.gradientUnits()?c.x()+c.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x")),this.attribute("fy").hasValue()&&(g="objectBoundingBox"==this.gradientUnits()?c.y()+c.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));var h="objectBoundingBox"==this.gradientUnits()?(c.width()+c.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels();return a.createRadialGradient(f,g,0,d,e,h)}},f.Element.radialGradient.prototype=new f.Element.GradientBase,f.Element.stop=function(a){this.base=f.Element.ElementBase,this.base(a),this.offset=this.attribute("offset").numValue(),this.offset<0&&(this.offset=0),this.offset>1&&(this.offset=1);var b=this.style("stop-color",!0);""===b.value&&(b.value="#000"),this.style("stop-opacity").hasValue()&&(b=b.addOpacity(this.style("stop-opacity"))),this.color=b.value},f.Element.stop.prototype=new f.Element.ElementBase,f.Element.AnimateBase=function(a){this.base=f.Element.ElementBase,this.base(a),f.Animations.push(this),this.duration=0,this.begin=this.attribute("begin").toMilliseconds(),this.maxDuration=this.begin+this.attribute("dur").toMilliseconds(),this.getProperty=function(){var a=this.attribute("attributeType").value,b=this.attribute("attributeName").value;return"CSS"==a?this.parent.style(b,!0):this.parent.attribute(b,!0)},this.initialValue=null,this.initialUnits="",this.removed=!1,this.calcValue=function(){return""},this.update=function(a){if(null==this.initialValue&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits()),this.duration>this.maxDuration){if("indefinite"==this.attribute("repeatCount").value||"indefinite"==this.attribute("repeatDur").value)this.duration=0;else if("freeze"!=this.attribute("fill").valueOrDefault("remove")||this.frozen){if("remove"==this.attribute("fill").valueOrDefault("remove")&&!this.removed)return this.removed=!0,this.getProperty().value=this.parent.animationFrozen?this.parent.animationFrozenValue:this.initialValue,!0}else this.frozen=!0,this.parent.animationFrozen=!0,this.parent.animationFrozenValue=this.getProperty().value;return!1}this.duration=this.duration+a;var b=!1;if(this.begin<this.duration){var c=this.calcValue();if(this.attribute("type").hasValue()){var d=this.attribute("type").value;c=d+"("+c+")"}this.getProperty().value=c,b=!0}return b},this.from=this.attribute("from"),this.to=this.attribute("to"),this.values=this.attribute("values"),this.values.hasValue()&&(this.values.value=this.values.value.split(";")),this.progress=function(){var a={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var b=a.progress*(this.values.value.length-1),c=Math.floor(b),d=Math.ceil(b);a.from=new f.Property("from",parseFloat(this.values.value[c])),a.to=new f.Property("to",parseFloat(this.values.value[d])),a.progress=(b-c)/(d-c)}else a.from=this.from,a.to=this.to;return a}},f.Element.AnimateBase.prototype=new f.Element.ElementBase,f.Element.animate=function(a){this.base=f.Element.AnimateBase,this.base(a),this.calcValue=function(){var a=this.progress(),b=a.from.numValue()+(a.to.numValue()-a.from.numValue())*a.progress;return b+this.initialUnits}},f.Element.animate.prototype=new f.Element.AnimateBase,f.Element.animateColor=function(b){this.base=f.Element.AnimateBase,this.base(b),this.calcValue=function(){var b=this.progress(),c=new a(b.from.value),d=new a(b.to.value);if(c.ok&&d.ok){var e=c.r+(d.r-c.r)*b.progress,f=c.g+(d.g-c.g)*b.progress,g=c.b+(d.b-c.b)*b.progress;return"rgb("+parseInt(e,10)+","+parseInt(f,10)+","+parseInt(g,10)+")"}return this.attribute("from").value}},f.Element.animateColor.prototype=new f.Element.AnimateBase,f.Element.animateTransform=function(a){this.base=f.Element.AnimateBase,this.base(a),this.calcValue=function(){for(var a=this.progress(),b=f.ToNumberArray(a.from.value),c=f.ToNumberArray(a.to.value),d="",e=0;e<b.length;e++)d+=b[e]+(c[e]-b[e])*a.progress+" ";return d}},f.Element.animateTransform.prototype=new f.Element.animate,f.Element.font=function(a){this.base=f.Element.ElementBase,this.base(a),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.isRTL=!1,this.isArabic=!1,this.fontFace=null,this.missingGlyph=null,this.glyphs=[];for(var b=0;b<this.children.length;b++){var c=this.children[b];"font-face"==c.type?(this.fontFace=c,c.style("font-family").hasValue()&&(f.Definitions[c.style("font-family").value]=this)):"missing-glyph"==c.type?this.missingGlyph=c:"glyph"==c.type&&(""!=c.arabicForm?(this.isRTL=!0,this.isArabic=!0,"undefined"==typeof this.glyphs[c.unicode]&&(this.glyphs[c.unicode]=[]),this.glyphs[c.unicode][c.arabicForm]=c):this.glyphs[c.unicode]=c)}},f.Element.font.prototype=new f.Element.ElementBase,f.Element.fontface=function(a){this.base=f.Element.ElementBase,this.base(a),this.ascent=this.attribute("ascent").value,this.descent=this.attribute("descent").value,this.unitsPerEm=this.attribute("units-per-em").numValue()},f.Element.fontface.prototype=new f.Element.ElementBase,f.Element.missingglyph=function(a){this.base=f.Element.path,this.base(a),this.horizAdvX=0},f.Element.missingglyph.prototype=new f.Element.path,f.Element.glyph=function(a){this.base=f.Element.path,this.base(a),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.unicode=this.attribute("unicode").value,this.arabicForm=this.attribute("arabic-form").value},f.Element.glyph.prototype=new f.Element.path,f.Element.text=function(a){this.captureTextNodes=!0,this.base=f.Element.RenderedElementBase,this.base(a),this.baseSetContext=this.setContext,this.setContext=function(a){this.baseSetContext(a);var b=this.style("dominant-baseline").toTextBaseline();null==b&&(b=this.style("alignment-baseline").toTextBaseline()),null!=b&&(a.textBaseline=b)},this.getBoundingBox=function(){var a=this.attribute("x").toPixels("x"),b=this.attribute("y").toPixels("y"),c=this.parent.style("font-size").numValueOrDefault(f.Font.Parse(f.ctx.font).fontSize);return new f.BoundingBox(a,b-c,a+Math.floor(2*c/3)*this.children[0].getText().length,b)},this.renderChildren=function(a){this.x=this.attribute("x").toPixels("x"),this.y=this.attribute("y").toPixels("y"),this.attribute("dx").hasValue()&&(this.x+=this.attribute("dx").toPixels("x")),this.attribute("dy").hasValue()&&(this.y+=this.attribute("dy").toPixels("y")),this.x+=this.getAnchorDelta(a,this,0);for(var b=0;b<this.children.length;b++)this.renderChild(a,this,b)},this.getAnchorDelta=function(a,b,c){var d=this.style("text-anchor").valueOrDefault("start");if("start"!=d){for(var e=0,f=c;f<b.children.length;f++){var g=b.children[f];if(f>c&&g.attribute("x").hasValue())break;e+=g.measureTextRecursive(a)}return-1*("end"==d?e:e/2)}return 0},this.renderChild=function(a,b,c){var d=b.children[c];d.attribute("x").hasValue()?(d.x=d.attribute("x").toPixels("x")+b.getAnchorDelta(a,b,c),d.attribute("dx").hasValue()&&(d.x+=d.attribute("dx").toPixels("x"))):(d.attribute("dx").hasValue()&&(b.x+=d.attribute("dx").toPixels("x")),d.x=b.x),b.x=d.x+d.measureText(a),d.attribute("y").hasValue()?(d.y=d.attribute("y").toPixels("y"),d.attribute("dy").hasValue()&&(d.y+=d.attribute("dy").toPixels("y"))):(d.attribute("dy").hasValue()&&(b.y+=d.attribute("dy").toPixels("y")),d.y=b.y),b.y=d.y,d.render(a);for(var c=0;c<d.children.length;c++)b.renderChild(a,d,c)}},f.Element.text.prototype=new f.Element.RenderedElementBase,f.Element.TextElementBase=function(a){this.base=f.Element.RenderedElementBase,this.base(a),this.getGlyph=function(a,b,c){var d=b[c],e=null;if(a.isArabic){var f="isolated";(0==c||" "==b[c-1])&&c<b.length-2&&" "!=b[c+1]&&(f="terminal"),c>0&&" "!=b[c-1]&&c<b.length-2&&" "!=b[c+1]&&(f="medial"),c>0&&" "!=b[c-1]&&(c==b.length-1||" "==b[c+1])&&(f="initial"),"undefined"!=typeof a.glyphs[d]&&(e=a.glyphs[d][f],null==e&&"glyph"==a.glyphs[d].type&&(e=a.glyphs[d]))}else e=a.glyphs[d];return null==e&&(e=a.missingGlyph),e},this.renderChildren=function(a){var b=this.parent.style("font-family").getDefinition();if(null==b)""!=a.fillStyle&&a.fillText(f.compressSpaces(this.getText()),this.x,this.y),""!=a.strokeStyle&&a.strokeText(f.compressSpaces(this.getText()),this.x,this.y);else{var c=this.parent.style("font-size").numValueOrDefault(f.Font.Parse(f.ctx.font).fontSize),d=this.parent.style("font-style").valueOrDefault(f.Font.Parse(f.ctx.font).fontStyle),e=this.getText();b.isRTL&&(e=e.split("").reverse().join(""));for(var g=f.ToNumberArray(this.parent.attribute("dx").value),h=0;h<e.length;h++){var i=this.getGlyph(b,e,h),j=c/b.fontFace.unitsPerEm;a.translate(this.x,this.y),a.scale(j,-j);var k=a.lineWidth;a.lineWidth=a.lineWidth*b.fontFace.unitsPerEm/c,"italic"==d&&a.transform(1,0,.4,1,0,0),i.render(a),"italic"==d&&a.transform(1,0,-.4,1,0,0),a.lineWidth=k,a.scale(1/j,-1/j),a.translate(-this.x,-this.y),this.x+=c*(i.horizAdvX||b.horizAdvX)/b.fontFace.unitsPerEm,"undefined"==typeof g[h]||isNaN(g[h])||(this.x+=g[h])}}},this.getText=function(){},this.measureTextRecursive=function(a){for(var b=this.measureText(a),c=0;c<this.children.length;c++)b+=this.children[c].measureTextRecursive(a);return b},this.measureText=function(a){var b=this.parent.style("font-family").getDefinition();if(null!=b){var c=this.parent.style("font-size").numValueOrDefault(f.Font.Parse(f.ctx.font).fontSize),d=0,e=this.getText();b.isRTL&&(e=e.split("").reverse().join(""));for(var g=f.ToNumberArray(this.parent.attribute("dx").value),h=0;h<e.length;h++){var i=this.getGlyph(b,e,h);d+=(i.horizAdvX||b.horizAdvX)*c/b.fontFace.unitsPerEm,"undefined"==typeof g[h]||isNaN(g[h])||(d+=g[h])}return d}var j=f.compressSpaces(this.getText());if(!a.measureText)return 10*j.length;a.save(),this.setContext(a);var k=a.measureText(j).width;return a.restore(),k}},f.Element.TextElementBase.prototype=new f.Element.RenderedElementBase,f.Element.tspan=function(a){this.captureTextNodes=!0,this.base=f.Element.TextElementBase,this.base(a),this.text=f.compressSpaces(a.value||a.text||a.textContent||""),this.getText=function(){return this.children.length>0?"":this.text}},f.Element.tspan.prototype=new f.Element.TextElementBase,f.Element.tref=function(a){this.base=f.Element.TextElementBase,this.base(a),this.getText=function(){var a=this.getHrefAttribute().getDefinition();return null!=a?a.children[0].getText():void 0}},f.Element.tref.prototype=new f.Element.TextElementBase,f.Element.a=function(a){this.base=f.Element.TextElementBase,this.base(a),this.hasText=a.childNodes.length>0;for(var b=0;b<a.childNodes.length;b++)3!=a.childNodes[b].nodeType&&(this.hasText=!1);this.text=this.hasText?a.childNodes[0].value:"",this.getText=function(){return this.text},this.baseRenderChildren=this.renderChildren,this.renderChildren=function(a){if(this.hasText){this.baseRenderChildren(a);var b=new f.Property("fontSize",f.Font.Parse(f.ctx.font).fontSize);f.Mouse.checkBoundingBox(this,new f.BoundingBox(this.x,this.y-b.toPixels("y"),this.x+this.measureText(a),this.y))}else if(this.children.length>0){var c=new f.Element.g;c.children=this.children,c.parent=this,c.render(a)}},this.onclick=function(){window.open(this.getHrefAttribute().value)},this.onmousemove=function(){f.ctx.canvas.style.cursor="pointer"}},f.Element.a.prototype=new f.Element.TextElementBase,f.Element.image=function(a){this.base=f.Element.RenderedElementBase,this.base(a);var b=this.getHrefAttribute().value;if(""!=b){var c=b.match(/\.svg$/);if("data:image/png;base64"!=b.substring(0,21)&&f.Images.push(this),this.loaded=!1,c)this.img=f.ajax(b),this.loaded=!0;else{this.img=document.createElement("img"),1==f.opts.useCORS&&(this.img.crossOrigin="Anonymous");var d=this;this.img.onload=function(){d.loaded=!0},this.img.onerror=function(){f.log('ERROR: image "'+b+'" not found'),d.loaded=!0},this.img.src=b}this.renderChildren=function(a){var b=this.attribute("x").toPixels("x"),d=this.attribute("y").toPixels("y"),e=this.attribute("width").toPixels("x"),g=this.attribute("height").toPixels("y");0!=e&&0!=g&&(a.save(),c?a.drawSvg(this.img,b,d,e,g):(a.translate(b,d),f.AspectRatio(a,this.attribute("preserveAspectRatio").value,e,this.img.width,g,this.img.height,0,0),a.drawImage(this.img,0,0)),a.restore())},this.getBoundingBox=function(){var a=this.attribute("x").toPixels("x"),b=this.attribute("y").toPixels("y"),c=this.attribute("width").toPixels("x"),d=this.attribute("height").toPixels("y");return new f.BoundingBox(a,b,a+c,b+d)}}},f.Element.image.prototype=new f.Element.RenderedElementBase,f.Element.g=function(a){this.base=f.Element.RenderedElementBase,this.base(a),this.getBoundingBox=function(){for(var a=new f.BoundingBox,b=0;b<this.children.length;b++)a.addBoundingBox(this.children[b].getBoundingBox());return a}},f.Element.g.prototype=new f.Element.RenderedElementBase,f.Element.symbol=function(a){this.base=f.Element.RenderedElementBase,this.base(a),this.render=function(a){}},f.Element.symbol.prototype=new f.Element.RenderedElementBase,f.Element.style=function(a){this.base=f.Element.ElementBase,this.base(a);for(var b="",d=0;d<a.childNodes.length;d++)b+=a.childNodes[d].data;b=b.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,""),b=f.compressSpaces(b);for(var e=b.split("}"),d=0;d<e.length;d++)if(""!=f.trim(e[d]))for(var g=e[d].split("{"),h=g[0].split(","),i=g[1].split(";"),j=0;j<h.length;j++){var k=f.trim(h[j]);if(""!=k){for(var l=f.Styles[k]||{},m=0;m<i.length;m++){var n=i[m].indexOf(":"),o=i[m].substr(0,n),p=i[m].substr(n+1,i[m].length-n);null!=o&&null!=p&&(l[f.trim(o)]=new f.Property(f.trim(o),f.trim(p)))}if(f.Styles[k]=l,f.StylesSpecificity[k]=c(k),"@font-face"==k)for(var q=l["font-family"].value.replace(/"/g,""),r=l.src.value.split(","),s=0;s<r.length;s++)if(r[s].indexOf('format("svg")')>0)for(var t=r[s].indexOf("url"),u=r[s].indexOf(")",t),v=r[s].substr(t+5,u-t-6),w=f.parseXml(f.ajax(v)),x=w.getElementsByTagName("font"),y=0;y<x.length;y++){var z=f.CreateElement(x[y]);f.Definitions[q]=z}}}},f.Element.style.prototype=new f.Element.ElementBase,f.Element.use=function(a){this.base=f.Element.RenderedElementBase,this.base(a),this.baseSetContext=this.setContext,this.setContext=function(a){this.baseSetContext(a),this.attribute("x").hasValue()&&a.translate(this.attribute("x").toPixels("x"),0),this.attribute("y").hasValue()&&a.translate(0,this.attribute("y").toPixels("y"))};var b=this.getHrefAttribute().getDefinition();this.path=function(a){null!=b&&b.path(a)},this.getBoundingBox=function(){return null!=b?b.getBoundingBox():void 0},this.renderChildren=function(a){if(null!=b){var c=b;"symbol"==b.type&&(c=new f.Element.svg,c.type="svg",c.attributes.viewBox=new f.Property("viewBox",b.attribute("viewBox").value),c.attributes.preserveAspectRatio=new f.Property("preserveAspectRatio",b.attribute("preserveAspectRatio").value),c.attributes.overflow=new f.Property("overflow",b.attribute("overflow").value),c.children=b.children),"svg"==c.type&&(this.attribute("width").hasValue()&&(c.attributes.width=new f.Property("width",this.attribute("width").value)),this.attribute("height").hasValue()&&(c.attributes.height=new f.Property("height",this.attribute("height").value)));var d=c.parent;c.parent=null,c.render(a),c.parent=d}}},f.Element.use.prototype=new f.Element.RenderedElementBase,f.Element.mask=function(a){this.base=f.Element.ElementBase,this.base(a),this.apply=function(a,b){var c=this.attribute("x").toPixels("x"),d=this.attribute("y").toPixels("y"),e=this.attribute("width").toPixels("x"),g=this.attribute("height").toPixels("y");if(0==e&&0==g){for(var h=new f.BoundingBox,i=0;i<this.children.length;i++)h.addBoundingBox(this.children[i].getBoundingBox());var c=Math.floor(h.x1),d=Math.floor(h.y1),e=Math.floor(h.width()),g=Math.floor(h.height())}var j=b.attribute("mask").value;b.attribute("mask").value="";var k=document.createElement("canvas");k.width=c+e,k.height=d+g;var l=k.getContext("2d");this.renderChildren(l);var m=document.createElement("canvas");m.width=c+e,m.height=d+g;var n=m.getContext("2d");b.render(n),n.globalCompositeOperation="destination-in",n.fillStyle=l.createPattern(k,"no-repeat"),n.fillRect(0,0,c+e,d+g),a.fillStyle=n.createPattern(m,"no-repeat"),a.fillRect(0,0,c+e,d+g),b.attribute("mask").value=j},this.render=function(a){}},f.Element.mask.prototype=new f.Element.ElementBase,f.Element.clipPath=function(a){this.base=f.Element.ElementBase,this.base(a),this.apply=function(a){var b=CanvasRenderingContext2D.prototype.beginPath;CanvasRenderingContext2D.prototype.beginPath=function(){};var c=CanvasRenderingContext2D.prototype.closePath;CanvasRenderingContext2D.prototype.closePath=function(){},b.call(a);for(var d=0;d<this.children.length;d++){var e=this.children[d];if("undefined"!=typeof e.path){var g=null;e.style("transform",!1,!0).hasValue()&&(g=new f.Transform(e.style("transform",!1,!0).value),g.apply(a)),e.path(a),CanvasRenderingContext2D.prototype.closePath=c,g&&g.unapply(a)}}c.call(a),a.clip(),CanvasRenderingContext2D.prototype.beginPath=b,CanvasRenderingContext2D.prototype.closePath=c},this.render=function(a){}},f.Element.clipPath.prototype=new f.Element.ElementBase,f.Element.filter=function(a){this.base=f.Element.ElementBase,this.base(a),this.apply=function(a,b){var c=b.getBoundingBox(),d=Math.floor(c.x1),e=Math.floor(c.y1),f=Math.floor(c.width()),g=Math.floor(c.height()),h=b.style("filter").value;b.style("filter").value="";for(var i=0,j=0,k=0;k<this.children.length;k++){var l=this.children[k].extraFilterDistance||0;i=Math.max(i,l),j=Math.max(j,l)}var m=document.createElement("canvas");m.width=f+2*i,m.height=g+2*j;var n=m.getContext("2d");n.translate(-d+i,-e+j),b.render(n);for(var k=0;k<this.children.length;k++)"function"==typeof this.children[k].apply&&this.children[k].apply(n,0,0,f+2*i,g+2*j);a.drawImage(m,0,0,f+2*i,g+2*j,d-i,e-j,f+2*i,g+2*j),b.style("filter",!0).value=h},this.render=function(a){}},f.Element.filter.prototype=new f.Element.ElementBase,f.Element.feMorphology=function(a){this.base=f.Element.ElementBase,this.base(a),this.apply=function(a,b,c,d,e){}},f.Element.feMorphology.prototype=new f.Element.ElementBase,f.Element.feComposite=function(a){this.base=f.Element.ElementBase,this.base(a),this.apply=function(a,b,c,d,e){}},f.Element.feComposite.prototype=new f.Element.ElementBase,f.Element.feColorMatrix=function(a){function b(a,b,c,d,e,f){return a[c*d*4+4*b+f]}function c(a,b,c,d,e,f,g){a[c*d*4+4*b+f]=g}function d(a,b){var c=e[a];return c*(0>c?b-255:b)}this.base=f.Element.ElementBase,this.base(a);var e=f.ToNumberArray(this.attribute("values").value);switch(this.attribute("type").valueOrDefault("matrix")){case"saturate":var g=e[0];e=[.213+.787*g,.715-.715*g,.072-.072*g,0,0,.213-.213*g,.715+.285*g,.072-.072*g,0,0,.213-.213*g,.715-.715*g,.072+.928*g,0,0,0,0,0,1,0,0,0,0,0,1];break;case"hueRotate":var h=e[0]*Math.PI/180,i=function(a,b,c){return a+Math.cos(h)*b+Math.sin(h)*c};e=[i(.213,.787,-.213),i(.715,-.715,-.715),i(.072,-.072,.928),0,0,i(.213,-.213,.143),i(.715,.285,.14),i(.072,-.072,-.283),0,0,i(.213,-.213,-.787),i(.715,-.715,.715),i(.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break;case"luminanceToAlpha":e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1]}this.apply=function(a,e,f,g,h){for(var i=a.getImageData(0,0,g,h),f=0;h>f;f++)for(var e=0;g>e;e++){var j=b(i.data,e,f,g,h,0),k=b(i.data,e,f,g,h,1),l=b(i.data,e,f,g,h,2),m=b(i.data,e,f,g,h,3);c(i.data,e,f,g,h,0,d(0,j)+d(1,k)+d(2,l)+d(3,m)+d(4,1)),c(i.data,e,f,g,h,1,d(5,j)+d(6,k)+d(7,l)+d(8,m)+d(9,1)),c(i.data,e,f,g,h,2,d(10,j)+d(11,k)+d(12,l)+d(13,m)+d(14,1)),
c(i.data,e,f,g,h,3,d(15,j)+d(16,k)+d(17,l)+d(18,m)+d(19,1))}a.clearRect(0,0,g,h),a.putImageData(i,0,0)}},f.Element.feColorMatrix.prototype=new f.Element.ElementBase,f.Element.feGaussianBlur=function(a){this.base=f.Element.ElementBase,this.base(a),this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue()),this.extraFilterDistance=this.blurRadius,this.apply=function(a,c,d,e,g){return"undefined"==typeof b.canvasRGBA?void f.log("ERROR: StackBlur.js must be included for blur to work"):(a.canvas.id=f.UniqueId(),a.canvas.style.display="none",document.body.appendChild(a.canvas),b.canvasRGBA(a.canvas.id,c,d,e,g,this.blurRadius),void document.body.removeChild(a.canvas))}},f.Element.feGaussianBlur.prototype=new f.Element.ElementBase,f.Element.title=function(a){},f.Element.title.prototype=new f.Element.ElementBase,f.Element.desc=function(a){},f.Element.desc.prototype=new f.Element.ElementBase,f.Element.MISSING=function(a){f.log("ERROR: Element '"+a.nodeName+"' not yet implemented.")},f.Element.MISSING.prototype=new f.Element.ElementBase,f.CreateElement=function(a){var b=a.nodeName.replace(/^[^:]+:/,"");b=b.replace(/\-/g,"");var c=null;return c="undefined"!=typeof f.Element[b]?new f.Element[b](a):new f.Element.MISSING(a),c.type=a.nodeName,c},f.load=function(a,b){f.loadXml(a,f.ajax(b))},f.loadXml=function(a,b){f.loadXmlDoc(a,f.parseXml(b))},f.loadXmlDoc=function(a,b){f.init(a);var c=function(b){for(var c=a.canvas;c;)b.x-=c.offsetLeft,b.y-=c.offsetTop,c=c.offsetParent;return window.scrollX&&(b.x+=window.scrollX),window.scrollY&&(b.y+=window.scrollY),b};1!=f.opts.ignoreMouse&&(a.canvas.onclick=function(a){var b=c(new f.Point(null!=a?a.clientX:event.clientX,null!=a?a.clientY:event.clientY));f.Mouse.onclick(b.x,b.y)},a.canvas.onmousemove=function(a){var b=c(new f.Point(null!=a?a.clientX:event.clientX,null!=a?a.clientY:event.clientY));f.Mouse.onmousemove(b.x,b.y)});var d=f.CreateElement(b.documentElement);d.root=!0,d.addStylesFromStyleDefinition();var e=!0,g=function(){f.ViewPort.Clear(),a.canvas.parentNode&&f.ViewPort.SetCurrent(a.canvas.parentNode.clientWidth,a.canvas.parentNode.clientHeight),1!=f.opts.ignoreDimensions&&(d.style("width").hasValue()&&(a.canvas.width=d.style("width").toPixels("x"),a.canvas.style.width=a.canvas.width+"px"),d.style("height").hasValue()&&(a.canvas.height=d.style("height").toPixels("y"),a.canvas.style.height=a.canvas.height+"px"));var c=a.canvas.clientWidth||a.canvas.width,g=a.canvas.clientHeight||a.canvas.height;if(1==f.opts.ignoreDimensions&&d.style("width").hasValue()&&d.style("height").hasValue()&&(c=d.style("width").toPixels("x"),g=d.style("height").toPixels("y")),f.ViewPort.SetCurrent(c,g),null!=f.opts.offsetX&&(d.attribute("x",!0).value=f.opts.offsetX),null!=f.opts.offsetY&&(d.attribute("y",!0).value=f.opts.offsetY),null!=f.opts.scaleWidth||null!=f.opts.scaleHeight){var h=null,i=null,j=f.ToNumberArray(d.attribute("viewBox").value);null!=f.opts.scaleWidth&&(d.attribute("width").hasValue()?h=d.attribute("width").toPixels("x")/f.opts.scaleWidth:isNaN(j[2])||(h=j[2]/f.opts.scaleWidth)),null!=f.opts.scaleHeight&&(d.attribute("height").hasValue()?i=d.attribute("height").toPixels("y")/f.opts.scaleHeight:isNaN(j[3])||(i=j[3]/f.opts.scaleHeight)),null==h&&(h=i),null==i&&(i=h),d.attribute("width",!0).value=f.opts.scaleWidth,d.attribute("height",!0).value=f.opts.scaleHeight,d.style("transform",!0,!0).value+=" scale("+1/h+","+1/i+")"}1!=f.opts.ignoreClear&&a.clearRect(0,0,c,g),d.render(a),e&&(e=!1,"function"==typeof f.opts.renderCallback&&f.opts.renderCallback(b))},h=!0;f.ImagesLoaded()&&(h=!1,g()),f.intervalID=setInterval(function(){var a=!1;if(h&&f.ImagesLoaded()&&(h=!1,a=!0),1!=f.opts.ignoreMouse&&(a|=f.Mouse.hasEvents()),1!=f.opts.ignoreAnimation)for(var b=0;b<f.Animations.length;b++)a|=f.Animations[b].update(1e3/f.FRAMERATE);"function"==typeof f.opts.forceRedraw&&1==f.opts.forceRedraw()&&(a=!0),a&&(g(),f.Mouse.runEvents())},1e3/f.FRAMERATE)},f.stop=function(){f.intervalID&&clearInterval(f.intervalID)},f.Mouse=new function(){this.events=[],this.hasEvents=function(){return 0!=this.events.length},this.onclick=function(a,b){this.events.push({type:"onclick",x:a,y:b,run:function(a){a.onclick&&a.onclick()}})},this.onmousemove=function(a,b){this.events.push({type:"onmousemove",x:a,y:b,run:function(a){a.onmousemove&&a.onmousemove()}})},this.eventElements=[],this.checkPath=function(a,b){for(var c=0;c<this.events.length;c++){var d=this.events[c];b.isPointInPath&&b.isPointInPath(d.x,d.y)&&(this.eventElements[c]=a)}},this.checkBoundingBox=function(a,b){for(var c=0;c<this.events.length;c++){var d=this.events[c];b.isPointInBox(d.x,d.y)&&(this.eventElements[c]=a)}},this.runEvents=function(){f.ctx.canvas.style.cursor="";for(var a=0;a<this.events.length;a++)for(var b=this.events[a],c=this.eventElements[a];c;)b.run(c),c=c.parent;this.events=[],this.eventElements=[]}},f}var e,f=function(a,b,c){if(null!=a||null!=b||null!=c){"string"==typeof a&&(a=document.getElementById(a)),null!=a.svg&&a.svg.stop();var e=d(c||{});(1!=a.childNodes.length||"OBJECT"!=a.childNodes[0].nodeName)&&(a.svg=e);var g=a.getContext("2d");"undefined"!=typeof b.documentElement?e.loadXmlDoc(g,b):"<"==b.substr(0,1)?e.loadXml(g,b):e.load(g,b)}else for(var h=document.querySelectorAll("svg"),i=0;i<h.length;i++){var j=h[i],k=document.createElement("canvas");k.width=j.clientWidth,k.height=j.clientHeight,j.parentNode.insertBefore(k,j),j.parentNode.removeChild(j);var l=document.createElement("div");l.appendChild(j),f(k,l.innerHTML)}};"undefined"!=typeof Element.prototype.matches?e=function(a,b){return a.matches(b)}:"undefined"!=typeof Element.prototype.webkitMatchesSelector?e=function(a,b){return a.webkitMatchesSelector(b)}:"undefined"!=typeof Element.prototype.mozMatchesSelector?e=function(a,b){return a.mozMatchesSelector(b)}:"undefined"!=typeof Element.prototype.msMatchesSelector?e=function(a,b){return a.msMatchesSelector(b)}:"undefined"!=typeof Element.prototype.oMatchesSelector?e=function(a,b){return a.oMatchesSelector(b)}:(("function"==typeof jQuery||"function"==typeof Zepto)&&(e=function(a,b){return $(a).is(b)}),"undefined"==typeof e&&(e=Sizzle.matchesSelector));var g=/(\[[^\]]+\])/g,h=/(#[^\s\+>~\.\[:]+)/g,j=/(\.[^\s\+>~\.\[:]+)/g,k=/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,l=/(:[\w-]+\([^\)]*\))/gi,m=/(:[^\s\+>~\.\[:]+)/g,n=/([^\s\+>~\.\[:]+)/g;return"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.drawSvg=function(a,b,c,d,e){f(this.canvas,a,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:b,offsetY:c,scaleWidth:d,scaleHeight:e})}),f}),function(){var a=$.fn.is;$.fn.is=function(b){return"filtermanager"==$(this.context).attr("id")&&":focus"==b?!0:a.call(this,b)}}(jQuery),scatterPlot.prototype.loadData=function(a){var b=this;a.url?d3.csv(a.url,function(a,c){b.parseData(c),b.render(),b.parallelsPlot(),b.callback()}):a.data?(this.parseData(d3.csv.parse(a.data)),this.render(),this.parallelsPlot(),this.callback()):a.parsedData&&(this.data=a.parsedData,this.analyseData(),this.initData(),this.render(),this.parallelsPlot(),this.callback())},scatterPlot.prototype.analyseData=function(){this.col_ordinal=[];for(var a in this.data[0])if(this.data[0][a]instanceof Date)this.col_date.push(a);else{var b=_.filter(this.data,function(b){return!isNaN(b[a])});0==b.length&&this.col_ordinal.push(a)}},scatterPlot.prototype.createSubscript=function(a){var b="",c=a.split("_");if(c.length>1){b=c[0];for(var d=1;d<c.length;d++)b+=(" "+c[d]).sub()}else b=a;return b},scatterPlot.prototype.parseData=function(a){var b=this;this.data=null,b.data=a,all_dims=d3.keys(b.data[0]),this.residuals=!1;var c="";this.col_ordinal=[],d3.keys(b.data[0]).filter(function(a){a.indexOf("_res_")>-1&&(this.residuals=!0),a.indexOf("F_res_")>-1&&(c=a)}),d3.keys(b.data[0]).filter(function(a){if("{"==b.data[1][a].charAt(0))b.data.forEach(function(b){for(var c=b[a].substring(1,b[a].length-1),d=c.split(";"),e=d.length-1;e>=0;e--)if("B_NEC"==a){var f;switch(e){case 0:f="B_N";break;case 1:f="B_E";break;case 2:f="B_C"}this.residuals||(b[f]=parseFloat(d[e]))}else if(a.indexOf("B_NEC_res_")>-1){var f,g=a.replace("B_NEC_res_","");switch(e){case 0:f="B_N_res_"+g;break;case 1:f="B_E_res_"+g;break;case 2:f="B_C_res_"+g}b[f]=parseFloat(d[e])}delete b[a]});else{var c=+b.data[1][a];isNaN(c)?b.col_ordinal.push(a):b.data.forEach(function(b){b[a]=+b[a]})}this.residuals&&"F"==a&&b.data.forEach(function(b){delete b[a]})}),b.initData()},scatterPlot.prototype.initData=function(){var a=[],b=this;d3.keys(b.data[0]).filter(function(c){if(null!=b.sel_y)for(var d=0;d<b.sel_y.length;d++)c.indexOf("NEC")>-1?(c.replace("NEC","N")==b.sel_y[d]||c.replace("NEC","E")==b.sel_y[d]||c.replace("NEC","C")==b.sel_y[d])&&a.push(b.sel_y[d]):c==b.sel_y[d]&&a.push(b.sel_y[d])}),(null==this.sel_y||0==a.length)&&(this.residuals?a=[res_key]:d3.keys(b.data[0])[5]&&(a=[d3.keys(b.data[0])[5]])),this.sel_y=a,this.parameter_colors=d3.scale.ordinal().domain(d3.keys(b.data[0])).range(b.parameter_color_range),this.data.forEach(function(a){a.active=1}),this.headerNames=d3.keys(b.data[0]),this.headerNames=_.sortBy(this.headerNames,function(a){return a.toLowerCase()}),this.identifiers=d3.set(b.data.map(function(a){return a.id})).values(),this.colors=d3.scale.ordinal().domain(b.identifiers).range(d3.scale.category10().range());for(var c=b.toIgnore.length-1;c>=0;c--){var d=b.headerNames.indexOf(b.toIgnore[c]);d>-1&&b.headerNames.splice(d,1)}var e=null;b.headerNames.indexOf(b.sel_x)>-1&&(e=b.sel_x),e?b.sel_x=e:b.sel_x="Latitude",b.active_brushes.length>0&&_.each(b.data,function(a){active=!0,b.active_brushes.forEach(function(c){a.hasOwnProperty(c)&&(b.brush_extents[c][0]<=a[c]&&a[c]<=b.brush_extents[c][1]||(active=!1))}),a.active=active?1:0});var f=_.uniq(this.data,function(a){return a.id});this.dataset_ids=[];for(var c=0;c<f.length;c++)this.dataset_ids.push(f[c].id)},scatterPlot.prototype.render=function(){function a(a){var b;return b=-1!=j.col_date.indexOf(a)?d3.time.scale.utc().range([l-j.margin.bottom,0]):-1!=j.col_ordinal.indexOf(a)?d3.scale.ordinal().rangePoints([0,l-j.margin.bottom]):d3.scale.linear().range([0,l-j.margin.bottom])}function b(){j.scatter_svg.select(".x.axis").call(j.xAxis),j.scatter_svg.select(".y.axis").call(j.yAxis_left),M=d3.behavior.zoom().x(j.xScale).y(j.yScale_left).on("zoom",c),j.right_scale.length>0&&(j.scatter_svg.select(".y2.axis").call(j.yAxis_right),P=d3.behavior.zoom().y(j.yScale_right).on("zoom",b)),j.scatter_svg.select("rect.zoom.xy.box").call(M),j.updatedots(),j.updateTicks(),d()}function c(){j.scatter_svg.select(".x.axis").call(j.xAxis),j.scatter_svg.select(".y.axis").call(j.yAxis_left),j.right_scale.length>0&&P.scale(M.scale()).translate(M.translate()),N=d3.behavior.zoom().x(j.xScale).on("zoom",b),O=d3.behavior.zoom().y(j.yScale_left).on("zoom",b),j.updatedots(),j.updateTicks(),d()}function d(a){j.scatter_svg.select("rect.zoom.x.box").call(N),j.scatter_svg.select("rect.zoom.y.box").call(O),j.right_scale.length>0&&j.scatter_svg.select("rect.zoom.y2.box").call(P)}function e(a){if(j.lineConnections){var b=d3.svg.line().x(function(a){return j.xScale(a[j.sel_x])}).y(function(b){return j.yAxis_left(b[a])});j.scatter_svg.selectAll(".line_"+a).remove(),j.scatter_svg.append("path").attr("class","area").attr("clip-path","url(#clip)").attr("class","line_"+a).attr("d",b(j.data)).style("fill","none").style("stroke",function(b){return j.parameter_colors(a)})}}function f(){for(var a=j.yAxis_left.ticks(70),b=[],c=0;c<a.length;c++)b.push(!1);for(var c=0;c<j.data.length;c++){for(var d=0,e=0;e<a.length;e++)if(a[e]>j.data[c].height){d=e-1;break}if(d>0)if(b[d]){for(var f=!1,g=0;g<b[d].length;g++){var h=b[d][g];if(j.data[c].starttime.getYear()!=h.starttime.getYear()||j.data[c].starttime.getMonth()!=h.starttime.getMonth()||j.data[c].starttime.getDate()!=h.starttime.getDate()||j.data[c].starttime.getHours()==h.starttime.getHours()&&j.data[c].starttime.getMinutes()==h.starttime.getMinutes()&&j.data[c].starttime.getSeconds()==h.starttime.getSeconds()||(j.daily_products=!1),j.data[c].starttime.getTime()==h.starttime.getTime()){b[d][g].val=(h.val+j.data[c].val)/2,f=!0;break}}f||b[d].push({min_height:a[d-1],max_height:a[d],val:j.data[c].val,starttime:j.data[c].starttime,endtime:j.data[c].endtime})}else b[d]=[{min_height:a[d-1],max_height:a[d],val:j.data[c].val,starttime:j.data[c].starttime,endtime:j.data[c].endtime}]}j.data=_.filter(b,function(a){return a}),j.data=_.flatten(j.data)}function g(a,b,c){return"#"+((1<<24)+(a<<16)+(b<<8)+c).toString(16).slice(1)}function h(){Math.round((j.width-j.margin.right-j.margin.left)/_.size(W)/2),j.sel_y[0];j.scatter_svg.selectAll(".datarectangle").data(j.data).enter().append("rect").attr("class","area").attr("clip-path","url(#clip)").attr("class","datarectangle").attr("x",function(a){if(j.daily_products){var b=a.starttime;return b.setUTCHours(0,0,0,0),j.xScale(b)}return j.xScale(a.starttime)}).attr("y",function(a){return j.yAxis_left(a.max_height)}).attr("width",function(a){if(j.daily_products){var b=a.starttime;b.setUTCHours(23,59,59,999);var c=j.xScale(b);return b.setUTCHours(0,0,0,0),c-j.xScale(b)}return j.xScale(a.endtime)-j.xScale(a.starttime)}).attr("height",function(a){return j.yAxis_left(a.min_height)-j.yAxis_left(a.max_height)}).style("fill",function(a){var b=j.plotter.getColor(a.val);return g(b[0],b[1],b[2])}).style("stroke","none").on("mouseover",function(a){d3.select(this).style("stroke","black")}).on("mouseout",function(a){null==j.selectedpoint?d3.select(this).style("stroke","none"):j.selectedpoint!==this&&d3.select(this).style("stroke","none")}).on("click",function(a){null!=j.selectedpoint&&(d3.select(this).style("stroke","none"),j.selectedpoint=null),j.openinfo(a),j.selectedpoint=this;var b="";for(var c in a)propValue=a[c],propValue instanceof Date&&(propValue=propValue.toISOString()),"active"!=c&&(b=b+c+": "+propValue+"<br>");b="<br>"+b,j.tooltip.transition().duration(100).style("display","block"),j.tooltip.html(b).style("left",d3.event.pageX+10+"px").style("top",d3.event.pageY+3+"px");var d=j.tooltip.append("text").text("X").attr("style","position:absolute; right:13px; top:4px; cursor:pointer;").attr("font-family","sans-serif").attr("font-size","20px");d.on("click",function(){j.tooltip.transition().duration(100).style("display","none"),d3.select(j.selectedpoint).style("stroke","none"),j.selectedpoint=null,j.openinfo(null)})}),$(document).on("mousedown",function(a){"rect"==a.target.nodeName&&"AV-point-tooltip"!=a.target.className&&j.selectedpoint&&(j.tooltip.transition().duration(100).style("display","none"),d3.select(j.selectedpoint).style("stroke","none"),j.selectedpoint=null,j.openinfo(null))})}function i(){var a=$(j.scatterEl).width()-j.margin.left-j.margin.right,b=$(j.scatterEl).height()-j.margin.top-j.margin.bottom;j.height=b,j.width=a,j.scatter_svg.select("#clip").selectAll("rect").attr("width",a).attr("height",b-j.margin.bottom),j.scatter_svg.select("rect.zoom.xy.box").attr("width",a).attr("height",b-j.margin.bottom),j.scatter_svg.select("rect.zoom.x.box").attr("width",a).attr("height",j.margin.bottom).attr("transform","translate(0,"+(b-j.margin.bottom)+")"),j.scatter_svg.select("rect.zoom.y.box").attr("width",j.margin.left).attr("height",b-j.margin.bottom),j.scatter_svg.select("rect.zoom.y2.box").attr("width",j.margin.left).attr("height",b-j.margin.bottom).attr("transform","translate("+a+",0)"),j.scatter_svg.select(".y2.axis").attr("transform","translate("+a+",0)"),j.scatter_svg.select(".xaxislabel").attr("x",a-10).attr("transform","translate(0,"+(b-j.margin.bottom)+")"),j.xScale.range([0,a]),j.yScale_left.range([0,b-j.margin.bottom]),j.right_scale.length>0&&j.yScale_right.range([0,b-j.margin.bottom]);for(var c=j.sel_y.length-1;c>=0;c--){var d=j.scatter_svg.selectAll(".legend_"+j.sel_y[c]);d.select("circle").attr("cx",a-25),d.select("text").attr("x",a-34)}j.updateTicks(),j.scatter_svg.select(".x.axis").attr("transform","translate(0,"+(b-j.margin.bottom)+")").call(j.xAxis),j.scatter_svg.select(".y.axis").call(j.yAxis_left),j.yAxis_right&&j.scatter_svg.select(".y2.axis").call(j.yAxis_right),j.updatedots();for(var c=j.sel_y.length-1;c>=0;c--)e(j.sel_y[c]);j.renderBlocks&&(j.scatter_svg.selectAll(".datarectangle").attr("x",function(a){if(j.daily_products){var b=a.starttime;return b.setUTCHours(0,0,0,0),j.xScale(b)}return j.xScale(a.starttime)}).attr("y",function(a){return j.yAxis_left(a.max_height)}).attr("width",function(a){if(j.daily_products){var b=a.starttime;b.setUTCHours(23,59,59,999);var c=j.xScale(b);return b.setUTCHours(0,0,0,0),c-j.xScale(b)}return j.xScale(a.endtime)-j.xScale(a.starttime)}).attr("height",function(a){return j.yAxis_left(a.min_height)-j.yAxis_left(a.max_height)}),X.range([b-j.margin.bottom,0]),j.scatter_svg.selectAll(".color.axis").attr("transform","translate("+(a+40)+" ,0)").call(Y),j.scatter_svg.selectAll(".colorscaleimage").attr("width",b-j.margin.bottom).attr("transform","translate("+(a+17)+" ,"+(b-j.margin.bottom)+") rotate(270)"))}var j=this,k=$(this.scatterEl).width()-this.margin.left-this.margin.right,l=$(this.scatterEl).height()-this.margin.top-this.margin.bottom;this.height=l,this.width=k;for(var m=this.sel_y.length-1;m>=0;m--){var n=this.sel_y[m];d3.select(this.scatterEl).selectAll(".dot_"+n).remove()}if(d3.select("#save").remove(),d3.select("#pngdataurl").remove(),d3.select("#grid").remove(),d3.select("#imagerenderer").remove(),d3.selectAll(".SumoSelect").remove(),d3.select(this.scatterEl).selectAll("*").remove(),d3.select("body").append("canvas").attr("id","imagerenderer").attr("width",$(this.scatterEl).width()).attr("height",$(this.scatterEl).height()).attr("style","display: none").attr("xmlns","http://www.w3.org/2000/svg").attr("xmlns:xlink","http://www.w3.org/1999/xlink"),d3.select("body").append("div").attr("id","pngdataurl"),d3.select(this.scatterEl).append("button").attr("type","button").attr("class","btn btn-success").attr("id","save").attr("style","position: absolute; right: 149px; top: 7px").text("Save as Image"),d3.select(this.scatterEl).append("button").attr("type","button").attr("class","btn btn-success").attr("id","reset").attr("style","position: absolute; right: 380px; top: 7px").text("Reset Zoom"),d3.select("#reset").on("click",function(){j.render()}),d3.select("#save").on("click",function(){var a=d3.select(".scatter").attr("version",1.1).attr("xmlns","http://www.w3.org/2000/svg").node().innerHTML,b=$(j.scatterEl).height(),c=$(j.scatterEl).width();$("#imagerenderer").attr("width",c),$("#imagerenderer").attr("height",b);var d=document.querySelector("#imagerenderer"),e=d.getContext("2d");e.drawSvg(a,0,0,b,c),d.toBlob(function(a){saveAs(a,"Analytics.png")},"image/png",1)}),this.gridselector=d3.select(this.scatterEl).append("button").attr("type","button").attr("class","btn btn-success").attr("id","grid").attr("style","position: absolute; right: 275px; top: 7px").text("Toggle Grid"),d3.select(this.scatterEl).append("button").attr("type","button").attr("class","btn btn-success").attr("id","download_button").attr("style","position: absolute; right: 55px; top: 7px").text("Download"),this.showDropDownSelection){var o=d3.select(this.scatterEl).insert("div").attr("id","yselectiondropdown").attr("style","position: absolute;margin-left:"+this.margin.left+"px; margin-top:"+(this.margin.top-40)+"px;").append("select").attr("multiple","multiple");o.selectAll("option").data(this.headerNames).enter().append("option").text(function(a){-1!=j.sel_y.indexOf(a)&&d3.select(this).attr("selected","selected");var b="",c=a.split("_");if(c.length>1){b=c[0];for(var d=1;d<c.length;d++)b+=(" "+c[d]).sub()}else b=a;return d3.select(this).attr("value",a),b}),$(o).SumoSelect({okCancelInMulti:!0}),$(".SumoSelect").change(function(a){var b=[];$("#yselectiondropdown option:selected").each(function(a){b.push($(this).val())}),j.sel_y=b,j.render(),j.parallelsPlot()})}for(var p=[],m=0;m<j.sel_y.length;m++)for(var q=0;q<this.dataset_ids.length;q++)p.push(this.dataset_ids[q]+j.sel_y[m]);var r=[];r=p.length<=5?["#01a4d6","#2a7d2a","#ff8f4e","#7f6af5","#c8006e"]:p.length<=10?["#be4e3c","#8cd156","#7c48c2","#c9a84e","#c9519d","#83caae","#4f2f4c","#ce9fa3","#515f39","#7b8fc3"]:p.length<=15?["#7cd7ab","#6e4ccd","#94dc52","#cc4ec0","#628e40","#563b81","#cfb14a","#b591c7","#d55835","#6ca4c0","#c74d72","#41583f","#cdb49b","#4a2e40","#854e31"]:["#cfd14a","#6d41c8","#77d750","#cf44c0","#63d3a4","#d34d33","#667fd0","#c78c3a","#542b6e","#648d3d","#b670c4","#c4d29c","#cc4a74","#80becd","#7b3c30","#ca9ebf","#485939","#c8957e","#3a2334","#566882"],this.single_color_palette=d3.scale.ordinal().domain(p).range(r);var s=d3.select(this.scatterEl).append("div").attr("class","svg_container").attr("style","width: 100%;height: 100%;");if(this.scatter_svg=s.append("svg").attr("class","scatter").append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.showDropDownSelection){var t=d3.select(this.scatterEl).insert("div").attr("class","xselectdropdown").attr("style","position: relative; float:right;width:120px;bottom:55px; right:"+(this.margin.right+127)+"px;").append("select").attr("style","width: 250px;");t.selectAll("option").data(this.headerNames).enter().append("option").text(function(a){j.sel_x==a&&d3.select(this).attr("selected","selected");var b="",c=a.split("_");if(c.length>1){b=c[0];for(var d=1;d<c.length;d++)b+=(" "+c[d]).sub()}else b=a;return d3.select(this).attr("value",a),b}),$(t).SumoSelect({okCancelInMulti:!1,up:!0}),$(".xselectdropdown").find(".SumoSelect").change(function(a){j.sel_x=$(this).find("option:selected").val(),j.render(),j.parallelsPlot()})}var u;if(-1!=this.col_date.indexOf(this.sel_x)?(j.xScale=d3.time.scale.utc().range([0,k]),u=this.timeformat):-1!=this.col_ordinal.indexOf(this.sel_x)?j.xScale=d3.scale.ordinal().rangePoints([0,k]):j.xScale=d3.scale.linear().range([0,k]),j.xAxis=d3.svg.axis().scale(j.xScale).orient("bottom").tickFormat(u),-1!=this.col_vec.indexOf(this.sel_x)){var v=[];this.data.forEach(function(a){for(var b=0,c=a[j.sel_x].length-1;c>=0;c--)b+=Math.exp(a[j.sel_x][c]);b=Math.sqrt(b),v.push(b)}),j.xScale.domain(d3.extent(v,function(a){return a})).nice()}else if(-1!=this.col_ordinal.indexOf(this.sel_x))j.xScale.domain(this.data.map(function(a){return a[j.sel_x]}));else if(-1!=this.col_date.indexOf(this.sel_x)){var w=d3.extent(this.data,function(a){return a[j.sel_x]}),x=Math.abs(w[1].getTime()-w[0].getTime())/100*5,y=[new Date(w[0].getTime()-x),new Date(w[1].getTime()+x)];j.xScale.domain(y)}else{var w=d3.extent(this.data,function(a){return a[j.sel_x]}),x=Math.abs(w[1]-w[0])/100*5,y=[w[0]-x,w[1]+x];j.xScale.domain(y)}var z,A;if(this.left_scale=[],this.right_scale=[],1==this.sel_y.length){var B,n=this.sel_y[0];j.left_scale.push(j.sel_y[0]),B=-1!=this.col_ordinal.indexOf(n)?this.data.map(function(a){return a[n]}):d3.extent(this.data,function(a){return a[n]});var C=B[1],D=B[0]}else if(this.sel_y.length>=2){for(var E=[],m=0;m<this.sel_y.length;m++){var F=this.sel_y[m],G=d3.extent(this.data,function(a){return a[F]});E.push({parameter:F,domain:G,extent:Math.abs(G[1]-G[0])})}E=_.sortBy(E,"extent");var H=E[0],I=E[E.length-1];j.left_scale.push(I.parameter),j.right_scale.push(H.parameter);for(var m=1;m<E.length-1;m++){var J=Math.abs(E[m].extent/H.extent);J>300?j.left_scale.push(E[m].parameter):j.right_scale.push(E[m].parameter)}var C=d3.max(E,function(a,b){return-1!=j.left_scale.indexOf(a.parameter)?a.domain[1]:void 0}),D=d3.min(E,function(a,b){return-1!=j.left_scale.indexOf(a.parameter)?a.domain[0]:void 0}),K=d3.max(E,function(a,b){return-1!=j.right_scale.indexOf(a.parameter)?a.domain[1]:void 0}),L=d3.min(E,function(a,b){return-1!=j.right_scale.indexOf(a.parameter)?a.domain[0]:void 0})}if(j.yScale_left=a(this.left_scale[0]),j.yAxis_left=d3.svg.axis().scale(j.yScale_left).orient("left"),-1!=j.col_date.indexOf(this.left_scale[0]))z=this.timeformat,j.yAxis_left.tickFormat(z),j.yScale_left.domain([C,D]);else{var x=Math.abs(C-D)/100*5;j.yScale_left.domain([C+x,D-x])}if(j.yAxis_right=null,this.right_scale.length>0){j.yScale_right=a(this.right_scale[0]);var x=Math.abs(K-L)/100*5;j.yScale_right.domain([K+x,L-x]),j.yAxis_right=d3.svg.axis().scale(j.yScale_right).orient("right"),-1!=j.col_date.indexOf(this.right_scale[0])&&(A=this.timeformat,j.yAxis_right.tickFormat(A))}var M=d3.behavior.zoom().x(j.xScale).y(j.yScale_left).on("zoom",c),N=d3.behavior.zoom().x(j.xScale).on("zoom",b),O=d3.behavior.zoom().y(j.yScale_left).on("zoom",b);if(j.right_scale.length>0)var P=d3.behavior.zoom().y(j.yScale_right).on("zoom",b);this.scatter_svg.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",k).attr("height",l-this.margin.bottom);this.gridselector.on("click",function(){j.grid_active=!j.grid_active,j.grid_active?(j.scatter_svg.selectAll(".axis line").attr("stroke-width","1").attr("shape-rendering","crispEdges").attr("stroke","#D3D3D3"),j.xAxis.tickSize(-(j.height-j.margin.bottom)),j.yAxis_left.tickSize(-j.width)):(j.xAxis.tickSize(5),j.yAxis_left.tickSize(5),j.scatter_svg.selectAll(".axis line").attr("stroke-width","2").attr("shape-rendering","crispEdges").attr("stroke","#000")),j.scatter_svg.select(".x.axis").call(j.xAxis),j.scatter_svg.select(".y.axis").call(j.yAxis_left),j.yAxis_right&&j.scatter_svg.select(".y2.axis").call(j.yAxis_right)});var Q="",R=this.sel_x.split("_");if(R.length>1){Q="<tspan>"+R[0]+"</tspan>";for(var m=1;m<R.length;m++){var S="";1==m&&(S=' dy="5"'),Q+='<tspan style="font-size:10px;"'+S+"> "+R[m]+"</tspan>"}}else Q=this.sel_x;j.uom_set.hasOwnProperty(this.sel_x)&&null!=j.uom_set[this.sel_x].uom&&(Q+=" ["+this.uom_set[this.sel_x].uom+"] "),j.scatter_svg.append("g").attr("class","x axis").attr("transform","translate(0,"+(l-this.margin.bottom)+")").call(j.xAxis);for(var T=[],m=0;m<j.left_scale.length;m++){var U="",R=j.left_scale[m].split("_");U=R.length>1?R.join(" "):j.left_scale[m],j.uom_set.hasOwnProperty(j.left_scale[m])&&null!=j.uom_set[j.left_scale[m]].uom&&(U+=" ["+j.uom_set[j.left_scale[m]].uom+"] "),T.push(U)}if(T=T.join("; "),T=T.replace(/(?!^)dy="5"/g,""),j.scatter_svg.append("g").attr("class","y axis").call(j.yAxis_left).append("text").attr("class","label").attr("x",-10).attr("transform","rotate(-90)").attr("y",6).attr("dy","1em").style("text-anchor","end").html(T),d3.select(".y.axis").append("text").attr("transform","translate(0,"+(l-this.margin.bottom)+")").attr("class","xaxislabel").attr("x",k-10).attr("y",-10).style("text-anchor","end").html(Q),j.right_scale){for(var V=[],m=0;m<j.right_scale.length;m++){var U="",R=j.right_scale[m].split("_");U=R.length>1?R.join(" "):j.right_scale[m],j.uom_set.hasOwnProperty(j.right_scale[m])&&null!=j.uom_set[j.right_scale[m]].uom&&(U+=" ["+j.uom_set[j.right_scale[m]].uom+"] "),V.push(U)}V=V.join("; "),V=V.replace(/(?!^)dy="5"/g,""),j.right_scale.length>0&&j.scatter_svg.append("g").attr("class","y2 axis").attr("transform","translate("+k+",0)").call(j.yAxis_right).append("text").attr("class","label").attr("x",-10).attr("transform","rotate(-90)").attr("y",-20).attr("dy","1em").style("text-anchor","end").html(V)}if(j.updateTicks(),j.scatter_svg.append("rect").attr("width",k).attr("height",l-j.margin.bottom).attr("class","zoom xy box").style("visibility","hidden").attr("stroke","none").attr("fill","transparent").attr("pointer-events","all").call(M),j.renderBlocks){var W=_.countBy(this.data,"time");f(),h()}else for(var m=this.sel_y.length-1;m>=0;m--)j.renderdots(this.sel_y[m]),e(this.sel_y[m]);if(j.dataRange){var X=d3.scale.linear();X.domain(this.dataRange),X.range([l-j.margin.bottom,0]);var Y=d3.svg.axis().orient("right").tickSize(5).scale(X),Z=(X.domain()[1]-X.domain()[0])/10;Y.tickValues(d3.range(X.domain()[0],X.domain()[1]+Z,Z)),Y.tickFormat(d3.format(".3e"));j.scatter_svg.append("g").attr("class","color axis").attr("transform","translate("+(k+40)+" ,0)").call(Y);j.scatter_svg.selectAll(".color.axis path").attr("fill","none").attr("shape-rendering","crispEdges").attr("stroke","#000").attr("stroke-width","2"),j.scatter_svg.selectAll(".color.axis line").attr("stroke-width","2").attr("shape-rendering","crispEdges").attr("stroke","#000");var aa=this.plotter.getColorScaleImage().toDataURL("image/jpg");j.scatter_svg.append("image").attr("class","colorscaleimage").attr("width",l-j.margin.bottom).attr("height",20).attr("transform","translate("+(k+17)+" ,"+(l-j.margin.bottom)+") rotate(270)").attr("preserveAspectRatio","none").attr("xlink:href",aa)}if(!j.renderBlocks)for(var ba=20*this.sel_y.length,m=this.sel_y.length-1;m>=0;m--){var ca=j.scatter_svg.selectAll(".legend_"+j.sel_y[m]).data(j.identifiers).enter().append("g").attr("class","legend_"+j.sel_y[m]).attr("transform",function(a,b){return"translate(0,"+(20*m+b*ba)+")"});ca.append("circle").attr("cx",k-25).attr("cy",9).attr("r",4).style("fill",function(a){return j.single_color?j.single_color_palette(a+j.sel_y[m]):j.parameter_colors(j.sel_y[m])}).style("stroke",function(a){return j.single_color?j.single_color_palette(a+j.sel_y[m]):j.colors(a)}),ca.append("text").attr("x",k-34).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(a){var b=a+" - "+j.sel_y[m];return b})}j.scatter_svg.selectAll("text").style("font","400 13px Arial"),j.scatter_svg.selectAll("text").style("fill","black"),j.scatter_svg.selectAll("text").style("stroke","none"),$(window).resize(i),j.scatter_svg.append("rect").attr("class","zoom x box").attr("width",k).attr("height",this.margin.bottom).attr("fill","none").attr("stroke","none").attr("transform","translate(0,"+(l-this.margin.bottom)+")").style("visibility","hidden").attr("pointer-events","all").call(N),j.scatter_svg.append("rect").attr("class","zoom y box").attr("width",this.margin.left).attr("height",l-this.margin.bottom).attr("transform","translate("+-this.margin.left+",0)").attr("fill","none").attr("stroke","none").style("visibility","hidden").attr("pointer-events","all").call(O),j.right_scale.length>0&&j.scatter_svg.append("rect").attr("class","zoom y2 box").attr("width",this.margin.right).attr("height",l-this.margin.bottom).attr("transform","translate("+k+",0)").attr("fill","none").attr("stroke","none").style("visibility","hidden").attr("pointer-events","all").call(P)},scatterPlot.prototype.updateTicks=function(){var a=this;a.scatter_svg.selectAll(".axis .domain").attr("stroke-width","2").attr("stroke","#000").attr("shape-rendering","crispEdges").attr("fill","none"),a.scatter_svg.selectAll(".axis path").attr("stroke-width","2").attr("shape-rendering","crispEdges").attr("stroke","#000"),a.grid_active?(a.scatter_svg.selectAll(".axis line").attr("stroke-width","1").attr("shape-rendering","crispEdges").attr("stroke","#D3D3D3"),a.xAxis.tickSize(-(a.height-a.margin.bottom)),a.yAxis_left.tickSize(-a.width)):(a.xAxis.tickSize(5),a.yAxis_left.tickSize(5),a.scatter_svg.selectAll(".axis line").attr("stroke-width","2").attr("shape-rendering","crispEdges").attr("stroke","#000")),a.scatter_svg.select(".x.axis").call(a.xAxis),a.scatter_svg.select(".y.axis").call(a.yAxis_left),a.right_scale.length>0&&a.scatter_svg.select(".y2.axis").call(a.yAxis_right)},scatterPlot.prototype.renderdots=function(a){var b=this;b.scatter_svg.selectAll(".dot_"+a).on("click",null),b.scatter_svg.selectAll(".dot_"+a).on("mouseover",null),b.scatter_svg.selectAll(".dot_"+a).remove(),b.scatter_svg.selectAll(".dot_"+a).data(_.filter(b.data,function(b){return!isNaN(b[a])})).enter().append("circle").attr("class","area").attr("clip-path","url(#clip)").attr("class","dot_"+a).attr("r",3.5).attr("cx",function(a){return b.xScale(a[b.sel_x])}).attr("cy",function(c){return b.right_scale.length>0&&_.indexOf(b.right_scale,a)>-1?b.yScale_right(c[a]):b.yScale_left(c[a])}).style("fill",function(c){return c.active?b.single_color?b.single_color_palette(c.id+a):b.parameter_colors(a):"rgba(50,50,50,0.3)"}).style("fill-opacity",function(a){return a.active?1:.15}).style("stroke",function(c){return c.active?b.single_color?b.single_color_palette(c.id+a):b.colors(c.id):"rgba(50,50,50,0.3)"}).style("stroke-width",1).on("mouseover",function(a){
$(this).attr("r",7)}).on("click",function(a){null!=b.selectedpoint&&(b.selectedpoint.attr("r",3.5),b.selectedpoint=null),b.openinfo(a),b.selectedpoint=$(this);var c="";for(var d in a)propValue=a[d],propValue instanceof Date&&(propValue=propValue.toISOString()),"active"!=d&&(c=c+d+": "+propValue+"<br>");c="<br>"+c,b.tooltip.transition().duration(100).style("display","block"),b.tooltip.html(c).style("left",d3.event.pageX+10+"px").style("top",d3.event.pageY+3+"px");var e=b.tooltip.append("text").text("X").attr("style","position:absolute; right:13px; top:4px; cursor:pointer;").attr("font-family","sans-serif").attr("font-size","20px");e.on("click",function(){b.tooltip.transition().duration(100).style("display","none"),b.selectedpoint.attr("r",3.5),b.selectedpoint=null,b.openinfo(null)}),$(document).on("mousedown",function(a){"circle"!=a.target.nodeName&&"AV-point-tooltip"!=a.target.className&&b.selectedpoint&&(b.tooltip.transition().duration(100).style("display","none"),b.selectedpoint.attr("r",3.5),b.selectedpoint=null,b.openinfo(null))})}).on("mouseout",function(a){null==b.selectedpoint?$(this).attr("r",3.5):b.selectedpoint[0]!==$(this)[0]&&$(this).attr("r",3.5)})},scatterPlot.prototype.updatedots=function(a){for(var b=this,c=b.sel_y.length-1;c>=0;c--)b.scatter_svg.selectAll(".dot_"+b.sel_y[c]).attr("cx",function(a){return b.xScale(a[b.sel_x])}).attr("cy",function(a){return b.right_scale.length>0&&_.indexOf(b.right_scale,b.sel_y[c])>-1?b.yScale_right(a[b.sel_y[c]]):b.yScale_left(a[b.sel_y[c]])})},scatterPlot.prototype.applyFilters=function(){for(var a=this.sel_y.length-1;a>=0;a--)this.renderdots(this.sel_y[a])},scatterPlot.prototype.substractComponents=function(a,b,c){this.data.forEach(function(c){c[a+"-"+b]=c[a]-c[b]}),this.render()},scatterPlot.prototype.absolute=function(a,b){this.data.forEach(function(c){c.id==a&&(c[b]=Math.abs(c[b]))}),this.render()},scatterPlot.prototype.colatitude=function(a){this.data.forEach(function(a){a.Latitude<0&&(a.Latitude=90-a.Latitude)}),this.render()},scatterPlot.prototype.parallelsPlot=function(){function a(a){if($(a.originalEvent.srcElement).hasClass("erasorfunction")||$(a.originalEvent.srcElement).hasClass("w2ui-list-remove")||$(a.originalEvent.originalTarget).hasClass("erasorfunction")||$(a.originalEvent.originalTarget).hasClass("w2ui-list-remove")){var b=p.active_brushes.indexOf(a.item.id);b>-1&&(p.active_brushes.splice(b,1),p.y[a.item.id].brush.clear()),p.active_brushes=p.active_filters.filter(function(a){return!p.y[a].brush.empty()}),p.brush_extents={},p.active_brushes.map(function(a){p.brush_extents[a]=p.y[a].brush.extent()});var c,d={};_.each(p.data,function(a){c=!0,p.active_brushes.forEach(function(b){d[b]=p.brush_extents[b],p.brush_extents[b][0]<=a[b]&&a[b]<=p.brush_extents[b][1]||(c=!1)}),a.active=c?1:0}),p.filterset(d),p.parallelsPlot(),p.applyFilters()}}function b(a){if($(a.originalEvent.srcElement).hasClass("w2ui-list-remove")||$(a.originalEvent.originalTarget).hasClass("w2ui-list-remove")){var b=p.active_filters.indexOf(a.item.id);b>-1&&(p.active_filters.splice(b,1),p.y[a.item.id].brush.clear()),p.active_brushes=p.active_filters.filter(function(a){return!p.y[a].brush.empty()}),p.brush_extents={},p.active_brushes.map(function(a){p.brush_extents[a]=p.y[a].brush.extent()});var c,d={};_.each(p.data,function(a){c=!0,p.active_brushes.forEach(function(b){d[b]=p.brush_extents[b],p.brush_extents[b][0]<=a[b]&&a[b]<=p.brush_extents[b][1]||(c=!1)}),a.active=c?1:0}),p.filterset(d),p.parallelsPlot(),p.applyFilters()}}function c(a){e.active_brushes=e.active_filters.filter(function(a){return!e.y[a].brush.empty()}),e.brush_extents={},e.active_brushes.map(function(a){e.brush_extents[a]=e.y[a].brush.extent()});var b,c={};_.each(e.data,function(a){b=!0,e.active_brushes.forEach(function(d){c[d]=e.brush_extents[d],e.brush_extents[d][0]<=a[d]&&a[d]<=e.brush_extents[d][1]||(b=!1)}),a.active=b?1:0}),e.filterset(c),e.applyFilters(),e.parallelsPlot()}function d(){var a=70,b=$(e.histoEl).width()-e.histoMargin.left-e.histoMargin.right-a,c=$(e.histoEl).height()-e.histoMargin.top-e.histoMargin.bottom;d3.select(".parallels").attr("width",$(e.histoEl).width()).attr("height",$(e.histoEl).height()),e.x.rangePoints([0,b]);var d=e.hist_data,f=e.y;e.active_filters.forEach(function(a){f[a].range([c,0]);e.svg.selectAll("."+a).data(e.hist_data[a]).attr("transform",function(b){return"translate("+e.x(a)+","+(f[a](b.x)-c/d[a].length)+")"})}),e.svg.selectAll(".trait").data(e.active_filters).attr("transform",function(a){return"translate("+e.x(a)+")"}),e.svg.selectAll(".axis").data(e.active_filters).each(function(a){d3.select(this).call(e.axis.scale(f[a]))}),$("#filterinputgroup .w2ui-field").width($(e.histoEl).width()-e.shorten_width),$("#filtermanager").w2field("enum",{items:e.parameters,openOnFocus:!0,selected:e.active_filters,renderItem:function(a,b,c){a.style="width: 100px; margin-left:"+e.x(a.id)+"px; position: absolute;";var d=a.id,f="";_.find(e.active_brushes,function(a){return a==d})&&(f='<div class="erasoricon erasorfunction"><i class="fa fa-eraser erasorfunction" aria-hidden="true"></i></div>');var g=c+f+'<div style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;height:16px;width:58px;position:absolute; float:left;">'+e.createSubscript(a.id)+"</div>";if(e.uom_set.hasOwnProperty(a.id)&&null!=e.uom_set[a.id].name){var h="margin:-3px -10px -1px -7px;height: 20px;padding: 3px 10px 1px 7px;";g='<div data-toggle="tooltip" title="'+e.uom_set[a.id].name+'" style="'+h+'">'+c+f+'<div style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;height:16px;width:58px;position:absolute; float:left;">'+e.createSubscript(a.id)+"</div></div>"}return g},renderDrop:function(a,b){var c="<b>"+e.createSubscript(a.id)+"</b>";return e.uom_set.hasOwnProperty(a.id)&&null!=e.uom_set[a.id].uom&&(c+=" ["+e.uom_set[a.id].uom+"]"),e.uom_set.hasOwnProperty(a.id)&&null!=e.uom_set[a.id].name&&(c+=": "+e.uom_set[a.id].name),c}})}if(this.histoEl){var e=this;if(this.parameters=this.headerNames.slice(0),e.fieldsforfiltering.length>1){for(var f=!1,g=e.active_brushes.length-1;g>=0;g--){var h=e.fieldsforfiltering.indexOf(e.active_brushes[g]);-1==h&&(e.y[e.active_brushes[g]].brush.clear(),delete e.brush_extents[e.active_brushes[g]],e.active_brushes.splice(g,1),f=!0)}if(f){var i,j={};_.each(e.data,function(a){i=!0,e.active_brushes.forEach(function(b){j[b]=e.brush_extents[b],e.brush_extents[b][0]<=a[b]&&a[b]<=e.brush_extents[b][1]||(i=!1)}),a.active=i?1:0}),e.filterset(j),e.applyFilters()}e.active_filters=[];for(var g=0;g<e.fieldsforfiltering.length;g++)e.parameters.indexOf(e.fieldsforfiltering[g])>=0&&e.active_filters.push(e.fieldsforfiltering[g]);e.fieldsforfiltering=[]}d3.select(e.histoEl).selectAll(".brush").remove(),d3.select("#reset_filters").remove(),d3.select("#toggle_filters").remove(),this.parameters.forEach(function(a){var b=d3.select(e.histoEl).select("svg");b.selectAll("."+a).remove(),b.selectAll(".trait."+a).remove()}),$(this.histoEl).empty();_.each(this.col_vec.concat("Timestamp").concat("active").concat("F_wmm2010"),function(a){var b=e.parameters.indexOf(a);b>-1&&e.parameters.splice(b,1)}),_.each(e.toIgnoreHistogram,function(a){var b=e.parameters.indexOf(a);b>-1&&e.parameters.splice(b,1)}),e.parameters=_.sortBy(e.parameters,function(a){return a.toLowerCase()});var k='Hide filters <i class="fa fa-chevron-down" aria-hidden="true"></i>';if(e.filters_hidden&&(k='Show filters <i class="fa fa-chevron-up" aria-hidden="true"></i>'),d3.select(this.histoEl).append("button").attr("type","button").attr("class","btn btn-success").attr("id","toggle_filters").attr("style","position: absolute; left: 58px; top:-30px;").html(k),!e.filters_hidden){var l=70,m=$(this.histoEl).width()-this.histoMargin.left-this.histoMargin.right-l,n=$(this.histoEl).height()-this.histoMargin.top-this.histoMargin.bottom;this.x_hist={},this.hist_data={},this.y={},e.active_filters=_.sortBy(e.active_filters,function(a){return a.toLowerCase()}),this.x=d3.scale.ordinal().domain(e.active_filters).rangePoints([0,m]),this.axis=d3.svg.axis().orient("left");d3.svg.line();this.axis.tickFormat(d3.format(".3g"));var o=d3.select(this.histoEl).append("svg").attr("class","parallels").attr("width",$(this.histoEl).width()).attr("height",$(this.histoEl).height()).append("g").attr("display","block").attr("transform","translate("+(this.histoMargin.left+l)+","+this.histoMargin.top+")");d3.select(this.histoEl).append("button").attr("type","button").attr("class","btn btn-success").attr("disabled",!0).attr("id","reset_filters").attr("style","position: absolute; left: 174px; top:-30px;").html('Reset Filters <i class="fa fa-eraser erasorfunction" aria-hidden="true"></i>'),d3.select(this.histoEl).append("div").attr("class","input-group").attr("id","filterinputgroup").attr("style","position: absolute; top:12px; height:15px; width:100%; left:30px; padding-left:28px;").append("div").attr("class","input-group-btn").append("button").attr("id","addfilteropen").attr("type","button").attr("style","width:60px;").attr("class","btn btn-default dropdown-toggle").html('Add <span class="caret"></span>'),d3.select("#filterinputgroup").append("div").attr("class","w2ui-field").attr("style","position: absolute; height:15px; width:"+($(this.histoEl).width()-this.shorten_width)+"px; left:87px;").append("input").attr("id","filtermanager");var p=e;$("#filtermanager").w2field("enum",{items:e.parameters,openOnFocus:!0,selected:e.active_filters,renderItem:function(a,b,c){a.style="width: 100px; margin-left:"+e.x(a.id)+"px; position: absolute;";var d=a.id,f="";_.find(e.active_brushes,function(a){return a==d})&&(f='<div class="erasoricon erasorfunction"><i class="fa fa-eraser erasorfunction" aria-hidden="true"></i></div>');var g=c+f+'<div style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;height:16px;width:58px;position:absolute; float:left;">'+e.createSubscript(a.id)+"</div>";if(e.uom_set.hasOwnProperty(a.id)&&null!=e.uom_set[a.id].name){var h="margin:-3px -10px -1px -7px;height: 20px;padding: 3px 10px 1px 7px;";g='<div data-toggle="tooltip" title="'+e.uom_set[a.id].name+'" style="'+h+'">'+c+f+'<div style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;height:16px;width:58px;position:absolute; float:left;">'+e.createSubscript(a.id)+"</div></div>"}return g},renderDrop:function(a,b){var c="<b>"+e.createSubscript(a.id)+"</b>";return e.uom_set.hasOwnProperty(a.id)&&null!=e.uom_set[a.id].uom&&(c+=" ["+e.uom_set[a.id].uom+"]"),e.uom_set.hasOwnProperty(a.id)&&null!=e.uom_set[a.id].name&&(c+=": "+e.uom_set[a.id].name),c},onClick:a.bind(e),onRemove:b.bind(e)}),$("#addfilteropen").click(function(){$("#filtermanager").focus()}),$("#filtermanager").change(function(a){var b=$("#filtermanager").data("selected");e.active_filters=b.map(function(a){return a.id}),e.parallelsPlot()}),e.active_brushes.length>0&&d3.select("#reset_filters").attr("disabled",null),d3.select("#reset_filters").on("click",function(){e.active_brushes=[],e.filterset({}),_.each(e.data,function(a){a.active=!0}),e.parallelsPlot(),e.applyFilters()}),e.svg=o,e.active_filters.forEach(function(a){-1!=e.col_ordinal.indexOf(a)?e.y[a]=d3.scale.ordinal().rangePoints([n,0]).domain(e.data.map(function(b){return b[a]})):e.y[a]=d3.scale.linear().range([n,0]).domain(d3.extent(e.data,function(b){return b[a]})).nice(),e.y[a].brush=d3.svg.brush().y(e.y[a]).on("brushend",c).on("brush",function(a){var b=e.svg.selectAll(".trait."+a).selectAll(".resize.n"),c=e.svg.selectAll(".trait."+a).selectAll(".resize.s"),d=e.y[a].brush.extent(),f=d3.format(".02f");b.select("text").remove(),c.select("text").remove(),b.append("text").text(f(d[1])).style("transform","translate(15px,0px)"),c.append("text").text(f(d[0])).style("transform","translate(15px,0px)")});var b=[];_.each(e.data,function(c){c.active&&b.push(c[a])}),-1!=e.col_ordinal.indexOf(a)?e.hist_data[a]=d3.layout.histogram()(b.map(function(b){return b[a]})):e.hist_data[a]=d3.layout.histogram().bins(e.y[a].ticks(60))(b),b=null,e.x_hist[a]=d3.scale.linear().domain([0,d3.max(e.hist_data[a],function(a){return a.length})]).range([0,40])});var q=[];e.active_brushes.forEach(function(a){e.y.hasOwnProperty(a)?e.y[a].brush.extent(e.brush_extents[a]):q.push(a)});for(var g=q.length-1;g>=0;g--){var h=e.active_brushes.indexOf(q[g]);h>-1&&e.active_brushes.splice(h,1)}if(q.length>0){var j={};e.active_brushes.forEach(function(a){j[a]=e.brush_extents[a]}),e.filterset(j)}e.active_filters.forEach(function(a){var b=o.selectAll("."+a).data(e.hist_data[a]).enter().append("g").attr("class","bar "+a).attr("transform",function(b){var c=e.y[a](b.x)-n/e.hist_data[a].length;return c||(c=0),"translate("+e.x(a)+","+c+")"});b.append("rect").attr("height",n/e.hist_data[a].length-1).attr("width",function(b){return e.x_hist[a](b.y)}).style("fill","#1F77B4")});var r=o.selectAll(".trait").data(e.active_filters).enter().append("svg:g").attr("class",function(a){return"trait "+a}).attr("transform",function(a){return"translate("+e.x(a)+")"});r.append("svg:g").attr("class","axis").each(function(a){d3.select(this).call(e.axis.scale(e.y[a]))}),o.selectAll(".axis .domain").attr("stroke-width","2").attr("stroke","#000").attr("shape-rendering","crispEdges").attr("fill","none"),o.selectAll(".axis line").attr("stroke-width","2").attr("shape-rendering","crispEdges").attr("stroke","#000"),o.selectAll(".axis path").attr("stroke-width","2").attr("shape-rendering","crispEdges").attr("stroke","#000"),r.append("svg:g").attr("class","brush").each(function(a){d3.select(this).call(e.y[a].brush)}).selectAll("rect").attr("x",-8).attr("width",16)}var e=this;d3.select("#toggle_filters").on("click",function(){$(e.histoEl).empty(),$(window).off("resize",d),e.filters_hidden?(e.filters_hidden=!1,$(e.histoEl).css("height","39%"),$(e.scatterEl).animate({height:"60%"},{step:function(a,b){$(e.scatterEl).trigger("resize")},complete:function(){$(e.scatterEl).trigger("resize"),e.parallelsPlot()}})):(e.filters_hidden=!0,$(e.scatterEl).animate({height:"95%"},{step:function(a,b){$(e.scatterEl).trigger("resize")},complete:function(){$(e.scatterEl).trigger("resize"),$(e.histoEl).css("height","40px"),e.parallelsPlot()}}))}),$(window).resize(d)}};