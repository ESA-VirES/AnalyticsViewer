function iqr(a){return function(b,c){for(var d=b.quartiles[0],e=b.quartiles[2],f=(e-d)*a,c=-1,g=b.length;b[++c]<d-f;);for(;b[--g]>e+f;);return[c,g]}}function scatterPlot(a,b){this.margin={top:0,right:120,bottom:0,left:0},this.headerNames=null,this.selector=a.selector,this.colors=a.colors,this.parameter_colors=null,this.col_date=[],this.col_vec=[],this.sel_x="",this.sel_y=[],this.identifiers=[],this.active_brushes=[],this.brush_extents={},this.tooltip=d3.select("body").append("div").attr("class","point-tooltip").style("opacity",0);var c=this;a.url?d3.csv(a.url,function(a,d){c.parseData(d),c.render(),c.parallelsPlot(),b()}):a.data&&(this.parseData(d3.csv.parse(a.data)),this.render(),b())}!function(){function a(a){return[0,a.length-1]}function b(a){return[d3.quantile(a,.25),d3.quantile(a,.5),d3.quantile(a,.75)]}d3.box=function(){function c(a){a.each(function(a,b){a=a.values.map(h).sort(d3.ascending);var c=d3.select(this),l=a.length,m=a[0],n=a[l-1],o=a.quartiles=j(a),p=i&&i.call(this,a,b),q=p&&p.map(function(b){return a[b]}),r=p?d3.range(0,p[0]).concat(d3.range(p[1]+1,l)):d3.range(l),s=d3.scale.linear().domain(g&&g.call(this,a,b)||[m,n]).range([e,0]),t=this.__chart__||d3.scale.linear().domain([0,1/0]).range(s.range());this.__chart__=s;var u=c.selectAll("line.center").data(q?[q]:[]);u.enter().insert("line","rect").attr("class","center").attr("x1",d/2).attr("y1",function(a){return t(a[0])}).attr("x2",d/2).attr("y2",function(a){return t(a[1])}).style("opacity",1e-6).transition().duration(f).style("opacity",1).attr("y1",function(a){return s(a[0])}).attr("y2",function(a){return s(a[1])}),u.transition().duration(f).style("opacity",1).attr("y1",function(a){return s(a[0])}).attr("y2",function(a){return s(a[1])}),u.exit().transition().duration(f).style("opacity",1e-6).attr("y1",function(a){return s(a[0])}).attr("y2",function(a){return s(a[1])}).remove();var v=c.selectAll("rect.box").data([o]);v.enter().append("rect").attr("class","box").attr("x",0).attr("y",function(a){return t(a[2])}).attr("width",d).attr("height",function(a){return t(a[0])-t(a[2])}).transition().duration(f).attr("y",function(a){return s(a[2])}).attr("height",function(a){return s(a[0])-s(a[2])}),v.transition().duration(f).attr("y",function(a){return s(a[2])}).attr("height",function(a){return s(a[0])-s(a[2])});var w=c.selectAll("line.median").data([o[1]]);w.enter().append("line").attr("class","median").attr("x1",0).attr("y1",t).attr("x2",d).attr("y2",t).transition().duration(f).attr("y1",s).attr("y2",s),w.transition().duration(f).attr("y1",s).attr("y2",s);var x=c.selectAll("line.whisker").data(q||[]);x.enter().insert("line","circle, text").attr("class","whisker").attr("x1",0).attr("y1",t).attr("x2",d).attr("y2",t).style("opacity",1e-6).transition().duration(f).attr("y1",s).attr("y2",s).style("opacity",1),x.transition().duration(f).attr("y1",s).attr("y2",s).style("opacity",1),x.exit().transition().duration(f).attr("y1",s).attr("y2",s).style("opacity",1e-6).remove();var y=c.selectAll("circle.outlier").data(r,Number);y.enter().insert("circle","text").attr("class","outlier").attr("r",5).attr("cx",d/2).attr("cy",function(b){return t(a[b])}).style("opacity",1e-6).transition().duration(f).attr("cy",function(b){return s(a[b])}).style("opacity",1),y.transition().duration(f).attr("cy",function(b){return s(a[b])}).style("opacity",1),y.exit().transition().duration(f).attr("cy",function(b){return s(a[b])}).style("opacity",1e-6).remove();var z=k||s.tickFormat(8),A=c.selectAll("text.box").data(o);A.enter().append("text").attr("class","box").attr("dy",".3em").attr("dx",function(a,b){return 1&b?6:-6}).attr("x",function(a,b){return 1&b?d:0}).attr("y",t).attr("text-anchor",function(a,b){return 1&b?"start":"end"}).text(z).transition().duration(f).attr("y",s),A.transition().duration(f).text(z).attr("y",s);var B=c.selectAll("text.whisker").data(q||[]);B.enter().append("text").attr("class","whisker").attr("dy",".3em").attr("dx",6).attr("x",d).attr("y",t).text(z).style("opacity",1e-6).transition().duration(f).attr("y",s).style("opacity",1),B.transition().duration(f).text(z).attr("y",s).style("opacity",1),B.exit().transition().duration(f).attr("y",s).style("opacity",1e-6).remove()}),d3.timer.flush()}var d=1,e=1,f=0,g=null,h=Number,i=a,j=b,k=null;return c.width=function(a){return arguments.length?(d=a,c):d},c.height=function(a){return arguments.length?(e=a,c):e},c.tickFormat=function(a){return arguments.length?(k=a,c):k},c.duration=function(a){return arguments.length?(f=a,c):f},c.domain=function(a){return arguments.length?(g=null==a?a:d3.functor(a),c):g},c.value=function(a){return arguments.length?(h=a,c):h},c.whiskers=function(a){return arguments.length?(i=a,c):i},c.quartiles=function(a){return arguments.length?(j=a,c):j},c}}(),function(){function a(b,c,d){function e(a){var e=b(a),f=d>e,g=d3.extent(b.range()),h=g[0],i=g[1],j=f?d-h:i-d;return 0==j&&(j=i-h),(f?-1:1)*j*(c+1)/(c+j/Math.abs(e-d))+d}return e.distortion=function(a){return arguments.length?(c=+a,e):c},e.focus=function(a){return arguments.length?(d=+a,e):d},e.copy=function(){return a(b.copy(),c,d)},e.nice=b.nice,e.ticks=b.ticks,e.tickFormat=b.tickFormat,d3.rebind(e,b,"domain","range")}d3.fisheye={scale:function(b){return a(b(),3,0)},circular:function(){function a(a){var b=a.x-g[0],f=a.y-g[1],h=Math.sqrt(b*b+f*f);if(!h||h>=e)return{x:a.x,y:a.y,z:1};var i=c*(1-Math.exp(-h*d))/h*.75+.25;return{x:g[0]+b*i,y:g[1]+f*i,z:Math.min(i,10)}}function b(){return c=Math.exp(f),c=c/(c-1)*e,d=f/e,a}var c,d,e=200,f=2,g=[0,0];return a.radius=function(a){return arguments.length?(e=+a,b()):e},a.distortion=function(a){return arguments.length?(f=+a,b()):f},a.focus=function(b){return arguments.length?(g=b,a):g},b()}}}(),scatterPlot.prototype.parseData=function(a){this.format_date="%H:%M:%S";var b,c=/^(\d){4}-(\d){2}-(\d){2}/,d=this;d.data=a,all_dims=d3.keys(d.data[0]),dimensions=d3.keys(d.data[0]).filter(function(a){a.indexOf("Flag")>-1||a.indexOf("ASM")>-1||a.indexOf("q_NEC")>-1||a.indexOf("dF_")>-1||a.indexOf("other")>-1||a.indexOf("error")>-1||a.indexOf("dB_")>-1||a.indexOf("VFM")>-1||a.indexOf("Status")>-1?d.data.forEach(function(b){delete b[a]}):c.test(d.data[1][a])?(d.data.forEach(function(b){b[a]=new Date(b[a])}),d.col_date.push(a)):"{"==d.data[1][a].charAt(0)?d.data.forEach(function(b){for(var c=b[a].substring(1,b[a].length-1),d=c.split(";"),e=d.length-1;e>=0;e--)if("B_NEC"==a){var f;switch(e){case 0:f="B_N";break;case 1:f="B_E";break;case 2:f="B_C"}b[f]=parseFloat(d[e])}else if("B_NEC_res_chaos5"==a){var f;switch(e){case 0:f="B_N_res";break;case 1:f="B_E_res";break;case 2:f="B_C_res"}b[f]=parseFloat(d[e])}delete b[a]}):(b=parseFloat(d.data[1][a]))&&d.data.forEach(function(b){b[a]=parseFloat(b[a])})}),this.parameter_colors=d3.scale.ordinal().domain(dimensions).range(d3.scale.category20().range().reverse()),d.data.forEach(function(a){a.active=1}),d.headerNames=d3.keys(d.data[0]),d.headerNames.sort(),d.identifiers=d3.set(d.data.map(function(a){return a.id})).values(),d.colors=d.colors?arg.colors:d3.scale.ordinal().domain(d.identifiers).range(d3.scale.category10().range());var e=d.headerNames.indexOf("id");e>-1&&d.headerNames.splice(e,1),d.sel_x="Latitude",d.sel_y=["F"]},scatterPlot.prototype.render=function(){function a(){l.select(".x.axis").call(m),l.select(".y.axis").call(q),c()}function b(a){l.selectAll(".dot_"+a).data(d.data).enter().append("circle").attr("class","area").attr("clip-path","url(#clip)").attr("class","dot_"+a).style("display",function(a){return a.active?null:"none"}).attr("r",3.5).attr("cx",function(a){return i(a[d.sel_x])}).attr("cy",function(b){return o(b[a])}).style("fill",function(){return d.parameter_colors(a)}).style("stroke",function(a){return d.colors(a.id)}).on("mouseover",function(a){var b="";for(var c in a)propValue=a[c],b=b+c+": "+propValue+"<br>";d.tooltip.transition().duration(100).style("opacity",.9),d.tooltip.html(b).style("left",d3.event.pageX+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(){d.tooltip.transition().duration(100).style("opacity",0)})}function c(){var a=$(d.selector).width()-analytics.margin.left-analytics.margin.right,b=$(d.selector).height()-analytics.margin.top-analytics.margin.bottom;b=parseInt(b/100*60),k.attr("style","width:"+$(this.selector).width()+"px; height:60%"),$(g.node().parentNode).attr("style","position: absolute; z-index: 100;right:"+analytics.margin.right+"px;top:"+(b+20)+"px;"),u.attr("width",a).attr("height",b),i.range([0,a]),o.range([b,0]),w.select("circle").attr("cx",a-15),w.select("text").attr("x",a-24),l.select(".x.axis").select(".label").attr("x",a-10),d.grid_active?(l.selectAll(".axis line").attr("stroke-width","2").attr("shape-rendering","crispEdges").attr("stroke","#D3D3D3"),m.tickSize(-b),q.tickSize(-a)):(m.tickSize(5),q.tickSize(5),l.selectAll(".axis line").attr("stroke-width","2").attr("shape-rendering","crispEdges").attr("stroke","#000")),l.select(".x.axis").attr("transform","translate(0,"+b+")").call(m),l.select(".y.axis").call(q);for(var c=d.sel_y.length-1;c>=0;c--)l.selectAll(".dot_"+d.sel_y[c]).attr("cx",function(a){return i(a[d.sel_x])}).attr("cy",function(a){return o(a[d.sel_y[c]])})}var d=this,e=$(this.selector).width()-analytics.margin.left-analytics.margin.right,f=$(this.selector).height()-analytics.margin.top-analytics.margin.bottom;f=parseInt(f/100*60),$(this.selector).empty(),d3.select(this.selector).append("canvas").attr("width",$(this.selector).width()).attr("height",$(this.selector).height()).attr("style","display: none"),d3.select(this.selector).append("button").attr("type","button").attr("class","btn btn-success").attr("id","save").attr("style","position: absolute; right: 45px; top: 7px").text("Save"),d3.select("#save").on("click",function(){var a=d3.select(".scatter").attr("version",1.1).attr("xmlns","http://www.w3.org/2000/svg").node().parentNode.innerHTML,b=document.querySelector("canvas"),c=b.getContext("2d");c.drawSvg(a,0,0,$(this.selector).width(),f);var d=document.createElement("a");d.download="sample.png",d.href=b.toDataURL("image/png");var e='<img src="'+d.href+'">';d3.select("#pngdataurl").html(e),d.click()}),this.grid_active=!1,this.gridselector=d3.select(this.selector).append("button").attr("type","button").attr("class","btn btn-success").attr("id","grid").attr("style","position: absolute; right: 110px; top: 7px").text("Toggle Grid");var g=d3.select(this.selector).insert("div").attr("class","xselectdropdown").attr("style","position: absolute; z-index: 100;right:"+analytics.margin.right+"px;top:"+(f+20)+"px;").append("select").attr("style","width: 20px;");g.on("change",function(){d.sel_x=d3.select(this).property("value"),d.render(),d.parallelsPlot()}),g.selectAll("option").data(this.headerNames).enter().append("option").text(function(a){return d.sel_x==a&&d3.select(this).attr("selected","selected"),a});var h=d3.select(this.selector).insert("div").attr("style","position: absolute;margin-left:"+(analytics.margin.left+10)+"px; margin-top:"+(analytics.margin.top-40)+"px;").append("select").attr("multiple","multiple");h.selectAll("option").data(this.headerNames).enter().append("option").text(function(a){return-1!=d.sel_y.indexOf(a)&&d3.select(this).attr("selected","selected"),d3.select(this).attr("value",a),a}),$(h).SumoSelect({okCancelInMulti:!0}),$(".SumoSelect").change(function(){var a=[];_.each($(this).find(".optWrapper .selected"),function(b){a.push(b.dataset.val)}),d.sel_y=a,d.render(),d.parallelsPlot()});var i,j,k=(d3.scale.category10(),d3.select(this.selector).append("div").attr("class","svg_container").attr("style","width:"+$(this.selector).width()+"px; height:60%")),l=k.append("svg").attr("class","scatter").attr("width",e).attr("height",f).append("g").attr("transform","translate("+analytics.margin.left+","+analytics.margin.top+")");-1!=this.col_date.indexOf(this.sel_x)?(i=d3.time.scale().range([0,e]),j=d3.time.format(d.format_date)):(i=d3.scale.linear().range([0,e]),j=d3.format("s"));var m=d3.svg.axis().scale(i).orient("bottom").tickFormat(j);if(-1!=this.col_date.indexOf(this.sel_y)?(o=d3.time.scale().range([f,0]),p=d3.time.format(d.format_date)):(o=d3.scale.linear().range([f,0]),p=d3.format("s")),-1!=this.col_vec.indexOf(this.sel_x)){var n=[];this.data.forEach(function(a){for(var b=0,c=a[d.sel_x].length-1;c>=0;c--)b+=Math.exp(a[d.sel_x][c]);b=Math.sqrt(b),n.push(b)}),i.domain(d3.extent(n,function(a){return a})).nice()}else i.domain(d3.extent(this.data,function(a){return a[d.sel_x]})).nice();for(var o,p,q=d3.svg.axis().scale(o).orient("left").tickFormat(p),r=this.sel_y.length-1;r>=0;r--){var s=d3.extent(this.data,function(a){return a[d.sel_y[r]]});s[0]>o.domain()[0]&&0!=o.domain()[0]&&(s[0]=o.domain()[0]),s[1]<o.domain()[1]&&(s[1]=o.domain()[1]),o.domain(s).nice()}var t=d3.behavior.zoom().x(i).y(o).scaleExtent([1,10]).on("zoom",a);l.append("rect").attr("width",e).attr("height",f).attr("fill","transparent");var u=l.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",e).attr("height",f);l.attr("pointer-events","all"),l.call(t),this.gridselector.on("click",function(){d.grid_active=!d.grid_active,d.grid_active?(l.selectAll(".axis line").attr("stroke-width","2").attr("shape-rendering","crispEdges").attr("stroke","#D3D3D3"),m.tickSize(-f),q.tickSize(-e)):(m.tickSize(5),q.tickSize(5),l.selectAll(".axis line").attr("stroke-width","2").attr("shape-rendering","crispEdges").attr("stroke","#000")),l.select(".x.axis").call(m),l.select(".y.axis").call(q)}),l.append("g").attr("class","x axis").attr("transform","translate(0,"+f+")").call(m).append("text").attr("class","label").attr("x",e-10).attr("y",-6).style("text-anchor","end").text(this.sel_x),l.append("g").attr("class","y axis").call(q).append("text").attr("class","label").attr("x",-10).attr("transform","rotate(-90)").attr("y",6).attr("dy","1em").style("text-anchor","end").text(this.sel_y),l.selectAll(".axis .domain").attr("stroke-width","2").attr("stroke","#000").attr("shape-rendering","crispEdges").attr("fill","none"),l.selectAll(".axis line").attr("stroke-width","2").attr("shape-rendering","crispEdges").attr("stroke","#000"),l.selectAll(".axis path").attr("stroke-width","2").attr("shape-rendering","crispEdges").attr("stroke","#000");for(var r=this.sel_y.length-1;r>=0;r--)b(this.sel_y[r]);for(var v=20*this.sel_y.length,r=this.sel_y.length-1;r>=0;r--){var w=l.selectAll(".legend_"+d.sel_y[r]).data(this.identifiers).enter().append("g").attr("class","legend_"+d.sel_y[r]).attr("transform",function(a,b){return"translate(0,"+(r*v+20*b)+")"});w.append("circle").attr("cx",e-15).attr("cy",9).attr("r",4).style("fill",function(){return d.parameter_colors(d.sel_y[r])}).style("stroke",function(a){return d.colors(a)}),w.append("text").attr("x",e-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(a){return a+" - "+d.sel_y[r]})}$(window).resize(c)},scatterPlot.prototype.substractComponents=function(a,b){this.data.forEach(function(c){c[a+"-"+b]=c[a]-c[b]}),this.render()},scatterPlot.prototype.absolute=function(a,b){this.data.forEach(function(c){c.id==a&&(c[b]=Math.abs(c[b]))}),this.render()},scatterPlot.prototype.colatitude=function(){this.data.forEach(function(a){a.Latitude<0&&(a.Latitude=90-a.Latitude)}),this.render()},scatterPlot.prototype.parallelsPlot=function(){function a(){k.active_brushes=d.filter(function(a){return!h[a].brush.empty()}),k.brush_extents={},k.active_brushes.map(function(a){k.brush_extents[a]=h[a].brush.extent()});var a;_.each(k.data,function(b){a=!0,k.active_brushes.forEach(function(c){k.brush_extents[c][0]<=b[c]&&b[c]<=k.brush_extents[c][1]||(a=!1)}),b.active=a?1:0}),k.render(),k.parallelsPlot()}function b(){var a=$(k.selector).width()-k.margin.left-k.margin.right,b=$(k.selector).height()-k.margin.top-k.margin.bottom;b=parseInt(b/100*40),b-=30,g.rangePoints([0,a]),d.forEach(function(a){h[a].range([0,b]);var c=j.selectAll("."+a).attr("transform",function(c){return"translate("+g(a)+","+(h[a](c.x)-b/hist_data[a].length)+")"});c.append("rect").attr("width",function(b){return x_hist[a](b.y)})}),j.selectAll(".trait").attr("transform",function(a){return"translate("+g(a)+")"}),j.selectAll(".axis").each(function(a){d3.select(this).call(i.scale(h[a]))})}var c=(d3.select(this.selector),[]),d=this.headerNames.slice(0);_.each(this.col_vec.concat("Timestamp").concat("active").concat("F_wmm2010"),function(a){var b=d.indexOf(a);b>-1&&d.splice(b,1)});var e=$(this.selector).width()-this.margin.left-this.margin.right,f=$(this.selector).height()-this.margin.top-this.margin.bottom;f=parseInt(f/100*40),f-=30;var g=d3.scale.ordinal().domain(d).rangePoints([0,e]),h={};hist_data={},x_hist={};var i=(d3.svg.line(),d3.svg.axis().orient("left"));i.tickFormat(d3.format("g"));var j=d3.select(this.selector).append("svg").attr("class","parallels").attr("width",e).attr("height",f).append("g").attr("display","block").attr("transform","translate("+analytics.margin.left+","+analytics.margin.top+")"),k=this;d.forEach(function(b){h[b]=d3.scale.linear().range([f,0]).domain(d3.extent(k.data,function(a){return a[b]})).nice(),h[b].brush=d3.svg.brush().y(h[b]).on("brushend",a);var c=[];_.each(k.data,function(a){a.active&&c.push(a[b])}),hist_data[b]=d3.layout.histogram().bins(h[b].ticks(60))(c),x_hist[b]=d3.scale.linear().domain([0,d3.max(hist_data[b],function(a){return a.length})]).range([0,40])}),k.active_brushes.forEach(function(a){h[a].brush.extent(k.brush_extents[a])}),d.forEach(function(a){var b=j.selectAll("."+a).data(hist_data[a]).enter().append("g").attr("class","bar "+a).attr("transform",function(b){return"translate("+g(a)+","+(h[a](b.x)-f/hist_data[a].length)+")"});b.append("rect").attr("height",f/hist_data[a].length-1).attr("width",function(b){return x_hist[a](b.y)}).style("fill","#1F77B4")});var l=(d3.scale.category10().domain(c),j.selectAll(".trait").data(d).enter().append("svg:g").attr("class","trait").attr("transform",function(a){return"translate("+g(a)+")"}));l.append("svg:g").attr("class","axis").each(function(a){d3.select(this).call(i.scale(h[a]))}).append("svg:text").attr("text-anchor","middle").attr("y",-9).text(String),j.selectAll(".axis .domain").attr("stroke-width","2").attr("stroke","#000").attr("shape-rendering","crispEdges").attr("fill","none"),j.selectAll(".axis line").attr("stroke-width","2").attr("shape-rendering","crispEdges").attr("stroke","#000"),j.selectAll(".axis path").attr("stroke-width","2").attr("shape-rendering","crispEdges").attr("stroke","#000"),l.append("svg:g").attr("class","brush").each(function(a){d3.select(this).call(h[a].brush)}).selectAll("rect").attr("x",-8).attr("width",16),$(window).resize(b)};var x,y,analytics={margin:{top:20,right:20,bottom:90,left:70},nv_scatterPlot:function(a){function b(a){var b=[],c=[];for(i=0;i<a.length;i++){var d=$.map(a[i],function(a){return[a]});-1==c.indexOf(d[0])&&(c.push(d[0]),b.push({key:d[0],values:[]}))}for(j=0;j<c.length;j++)for(k=0;k<a.length;k++){var d=$.map(a[k],function(a){return[a]});d[0]==c[j]&&b[j].values.push({x:parseFloat(d[1]),y:parseFloat(d[2]),size:parseFloat(d[3])})}return b}var c=null;c=a.colors?a.colors:d3.scale.category10(),keyColor=function(a){var b=a.key.lastIndexOf("_"),d=a.key.substring(0,b);return c(d)};var d=nv.models.scatterChart().showDistX(!0).showDistY(!0).useVoronoi(!0).color(keyColor);d.xAxis.tickFormat(d3.format()),d.yAxis.tickFormat(d3.format()),d.tooltipContent(function(a){return"<p>"+a+"</p>"});var e=d3.select(a.selector),e=d3.select(a.selector);$(a.selector).empty();var f=$(a.selector).width()-analytics.margin.left-analytics.margin.right,g=$(a.selector).height()-analytics.margin.top-analytics.margin.bottom,h=d3.csv.parse(a.data);e.append("svg").attr("display","block").attr("width",f).attr("height",g).datum(b(h)).call(d),nv.utils.windowResize(d.update),d.dispatch.on("stateChange",function(a){JSON.stringify(a)})},boxPlot:function(a){function b(a){var b=[],c=[];for(i=0;i<a.length;i++){var d=$.map(a[i],function(a){return[a]});-1==c.indexOf(d[0])&&(c.push(d[0]),b.push({key:d[0],values:[]}))}for(j=0;j<c.length;j++)for(k=0;k<a.length;k++){var d=$.map(a[k],function(a){return[a]});if(d[0]==c[j]){var e=j,f=parseFloat(d[1]),g=b[e];g?b[j].values.push(f):g=b[e]=[f],f>l&&(l=f),h>f&&(h=f)}}return b}var c=null;c=a.colors?a.colors:d3.scale.category10(),keyColor=function(a){var b=a.key.lastIndexOf("_"),d=a.key.substring(0,b);return c(d)};var d=d3.select(a.selector);$(a.selector).empty();var e=$(a.selector).width()-analytics.margin.left-analytics.margin.right,f=$(a.selector).height()-analytics.margin.top-analytics.margin.bottom,g=40,h=1/0,l=-1/0,m=d3.csv.parse(a.data),n=b(m),o=e/n.length-2*g;o>100&&(o=100);var p=d3.box().whiskers(iqr(1.5)).width(o).height(f-analytics.margin.top-analytics.margin.bottom);p.domain([h,l]);d.selectAll("svg").attr("display","none").append("g").data(n).enter().append("svg").attr("class","box").attr("width",e/n.length).attr("height",f+analytics.margin.bottom+analytics.margin.top).append("g").attr("transform","translate("+(e/n.length/2-o/2)+","+analytics.margin.top+")").call(p).attr("stroke",keyColor)},stackedPlot:function(a){function b(a){var b=[],c=[];for(i=0;i<a.length;i++){var d=$.map(a[i],function(a){return[a]});-1==c.indexOf(d[0])&&(c.push(d[0]),b.push({key:d[0],values:[]}))}for(j=0;j<c.length;j++)for(k=0;k<a.length;k++){var d=$.map(a[k],function(a){return[a]});d[0]==c[j]&&b[j].values.push({0:new Date(d[1]),1:parseFloat(d[2])})}return b}var c=d3.scale.category20();keyColor=function(a){return c(a.key)};var d=d3.select(a.selector),d=d3.select(a.selector);$(a.selector).empty();var e=$(a.selector).width()-analytics.margin.left-analytics.margin.right,f=$(a.selector).height()-analytics.margin.top-analytics.margin.bottom,g=nv.models.stackedAreaChart().useInteractiveGuideline(!0).x(function(a){return a[0]}).y(function(a){return a[1]}).color(keyColor).transitionDuration(300);g.xAxis.tickFormat(function(a){return d3.time.format("%x")(new Date(a))}),g.yAxis.tickFormat(d3.format(".02f"));var h=d3.csv.parse(a.data);d.append("svg").attr("display","block").attr("width",e).attr("height",f).datum(b(h)).transition().duration(1e3).call(g).each("start",function(){setTimeout(function(){d.selectAll("svg *").each(function(){this.__transition__&&(this.__transition__.duration=1)})},0)}),nv.utils.windowResize(g.update)},linePlot:function(a){function b(a){var b=[],c=[];for(i=0;i<a.length;i++){var d=$.map(a[i],function(a){return[a]});-1==c.indexOf(d[0])&&(c.push(d[0]),b.push({key:d[0],values:[]}))}for(j=0;j<c.length;j++)for(k=0;k<a.length;k++){var d=$.map(a[k],function(a){return[a]});d[0]==c[j]&&b[j].values.push({0:new Date(d[1]),1:parseFloat(d[2])})}return b}var c=null;c=a.colors?a.colors:d3.scale.category10(),keyColor=function(a){return c(a.key)};var d=d3.select(a.selector);$(a.selector).empty();var e=$(a.selector).width()-analytics.margin.left-analytics.margin.right,f=$(a.selector).height()-analytics.margin.top-analytics.margin.bottom,g=nv.models.lineChart().margin({left:100}).useInteractiveGuideline(!0).transitionDuration(350).showLegend(!0).showYAxis(!0).showXAxis(!0).x(function(a){return a[0]}).y(function(a){return a[1]}).color(keyColor);g.xAxis.axisLabel("Time").tickFormat(function(a){return d3.time.format("%x %Hh")(new Date(a))}),g.yAxis.axisLabel("Values").tickFormat(d3.format(".02f"));var h=b(d3.csv.parse(a.data));d.append("svg").attr("display","block").attr("width",e).attr("height",f).datum(h).call(g),nv.utils.windowResize(g.update)},parallelsPlot:function(a){function b(a){return t(e.map(function(b){return[r(b),s[b](a[b])]}))}function c(){var a=e.filter(function(a){return!s[a].brush.empty()}),b=a.map(function(a){return s[a].brush.extent()});n.classed("fade",function(c){return!a.every(function(a,d){return b[d][0]<=c[a]&&c[a]<=b[d][1]})})}var d=d3.select(a.selector);$(a.selector).empty();var e=[],f=[],g=new Object,h=d3.csv.parse(a.data);for(i=0;i<h.length;i++){var j=$.map(h[i],function(a){return[a]});-1==f.indexOf(j[0])&&f.push(j[0])}for(i=0;i<h.length;i++)$.each(h[i],function(a,b){"undefined"==typeof g[a]||null==g[a]?g[a]=[parseFloat(b)]:g[a].push(parseFloat(b))});var k=(h.length,0),l=h[0];for(var m in l)0!=k?e.push(m):k=1;var n,o=f,p=$(a.selector).width()-analytics.margin.left-analytics.margin.right,q=$(a.selector).height()-analytics.margin.top-analytics.margin.bottom,r=d3.scale.ordinal().domain(e).rangePoints([0,p]),s={},t=d3.svg.line(),u=d3.svg.axis().orient("left"),v=d.append("svg:svg").attr("class","svg").attr("display","block").attr("width","100%").attr("height","100%").append("svg:g").attr("transform","translate("+analytics.margin.left+","+analytics.margin.top+")");console.log(g),e.forEach(function(a){console.log(a,d3.min(g[a]),d3.max(g[a])),s[a]=d3.scale.linear().domain([d3.min(g[a]),d3.max(g[a])]).range([q,0]),s[a].brush=d3.svg.brush().y(s[a]).on("brush",c)});var w=d3.scale.category10().domain(f),x=v.selectAll("g.legend").data(o).enter().append("svg:g").attr("class","legend").attr("transform",function(a,b){return"translate(0,"+(20*b+584)+")"});x.append("svg:line").attr("class",String).attr("x2",8).attr("stroke",function(a){return w(a)}),x.append("svg:text").attr("x",12).attr("dy",".31em").text(function(a){return"Item "+a}),n=v.append("svg:g").attr("class","foreground").selectAll("path").data(h).enter().append("svg:path").attr("d",b).attr("stroke",function(a){var b=$.map(a,function(a){return[a]});return w(b[0])}).attr("class",function(a){var b=$.map(a,function(a){return[a]});return b[0]});var y=v.selectAll(".trait").data(e).enter().append("svg:g").attr("class","trait").attr("transform",function(a){return"translate("+r(a)+")"});y.append("svg:g").attr("class","axis").each(function(a){d3.select(this).call(u.scale(s[a]))}).append("svg:text").attr("text-anchor","middle").attr("y",-9).text(String),y.append("svg:g").attr("class","brush").each(function(a){d3.select(this).call(s[a].brush)}).selectAll("rect").attr("x",-8).attr("width",16)}};